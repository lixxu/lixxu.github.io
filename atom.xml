<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>学会忍受孤独</title>
  
  <subtitle>他人笑我太疯癫, 我笑他人看不穿</subtitle>
  <link href="http://lixxu.github.io/atom.xml" rel="self"/>
  
  <link href="http://lixxu.github.io/"/>
  <updated>2023-01-09T07:33:18.268Z</updated>
  <id>http://lixxu.github.io/</id>
  
  <author>
    <name>lixxu</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>hexo新版本和主题设置备份</title>
    <link href="http://lixxu.github.io/2023/01/09/backup-new-hexo-config/"/>
    <id>http://lixxu.github.io/2023/01/09/backup-new-hexo-config/</id>
    <published>2023-01-09T06:48:31.000Z</published>
    <updated>2023-01-09T07:33:18.268Z</updated>
    
    <content type="html"><![CDATA[<p>参考来源:<br><a href="https://blog.zthxxx.me/post/hexo-automatic-add-readmore/">https://blog.zthxxx.me/post/hexo-automatic-add-readmore/</a><br><a href="https://utteranc.es/">https://utteranc.es/</a><br><a href="https://wangjiezhe.com/posts/2018-10-29-Hexo-NexT-3/">https://wangjiezhe.com/posts/2018-10-29-Hexo-NexT-3/</a><br><a href="https://www.simon96.online/2018/10/12/hexo-tutorial/">https://www.simon96.online/2018/10/12/hexo-tutorial/</a></p><p>时隔多年, 重新拾一下blog, 因为修改了一些主题的文件, 不备份一下下次配置时又要重头开始了, 浪费时间.</p><p>当前版本用到的插件:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;hexo&quot;:</span> <span class="string">&quot;^6.3.0&quot;</span><span class="string">,</span></span><br><span class="line"><span class="attr">&quot;hexo-deployer-git&quot;:</span> <span class="string">&quot;^3.0.0&quot;</span><span class="string">,</span></span><br><span class="line"><span class="attr">&quot;hexo-generator-archive&quot;:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="string">,</span></span><br><span class="line"><span class="attr">&quot;hexo-generator-category&quot;:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="string">,</span></span><br><span class="line"><span class="attr">&quot;hexo-generator-feed&quot;:</span> <span class="string">&quot;^3.0.0&quot;</span><span class="string">,</span></span><br><span class="line"><span class="attr">&quot;hexo-generator-index&quot;:</span> <span class="string">&quot;^3.0.0&quot;</span><span class="string">,</span></span><br><span class="line"><span class="attr">&quot;hexo-generator-sitemap&quot;:</span> <span class="string">&quot;^3.0.1&quot;</span><span class="string">,</span></span><br><span class="line"><span class="attr">&quot;hexo-generator-tag&quot;:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="string">,</span></span><br><span class="line"><span class="attr">&quot;hexo-helper-live2d&quot;:</span> <span class="string">&quot;^3.1.1&quot;</span><span class="string">,</span></span><br><span class="line"><span class="attr">&quot;hexo-renderer-ejs&quot;:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="string">,</span></span><br><span class="line"><span class="attr">&quot;hexo-renderer-marked&quot;:</span> <span class="string">&quot;^6.0.0&quot;</span><span class="string">,</span></span><br><span class="line"><span class="attr">&quot;hexo-renderer-stylus&quot;:</span> <span class="string">&quot;^2.1.0&quot;</span><span class="string">,</span></span><br><span class="line"><span class="attr">&quot;hexo-server&quot;:</span> <span class="string">&quot;^3.0.0&quot;</span></span><br></pre></td></tr></table></figure><p>hexo config文件:</p><figure class="highlight yaml"><figcaption><span>_config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hexo Configuration</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/configuration.html</span></span><br><span class="line"><span class="comment">## Source: https://github.com/hexojs/hexo/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">学会忍受孤独</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">他人笑我太疯癫,</span> <span class="string">我笑他人看不穿</span></span><br><span class="line"><span class="attr">description:</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">lixxu</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## If your site is put in a subdirectory, set url as &#x27;http://yoursite.com/child&#x27; and root as &#x27;/child/&#x27;</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">http://lixxu.github.io</span></span><br><span class="line"><span class="attr">root:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">&quot;:year/:month/:day/:title/&quot;</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br><span class="line"><span class="attr">pretty_urls:</span></span><br><span class="line">  <span class="attr">trailing_index:</span> <span class="literal">false</span> <span class="comment"># Set to false to remove trailing &#x27;index.html&#x27; from permalinks</span></span><br><span class="line">  <span class="attr">trailing_html:</span> <span class="literal">false</span> <span class="comment"># Set to false to remove trailing &#x27;.html&#x27; from permalinks</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory</span></span><br><span class="line"><span class="attr">source_dir:</span> <span class="string">source</span></span><br><span class="line"><span class="attr">public_dir:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">tag_dir:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">archive_dir:</span> <span class="string">archives</span></span><br><span class="line"><span class="attr">category_dir:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">code_dir:</span> <span class="string">downloads/code</span></span><br><span class="line"><span class="attr">i18n_dir:</span> <span class="string">:lang</span></span><br><span class="line"><span class="attr">skip_render:</span></span><br><span class="line"><span class="comment"># Scroll percent label in b2t button</span></span><br><span class="line"><span class="attr">scrollpercent:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Writing</span></span><br><span class="line"><span class="attr">new_post_name:</span> <span class="string">:year-:month-:day-:title.md</span></span><br><span class="line"><span class="attr">default_layout:</span> <span class="string">post</span></span><br><span class="line"><span class="attr">titlecase:</span> <span class="literal">false</span> <span class="comment"># Transform title into titlecase</span></span><br><span class="line"><span class="attr">external_link:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># Open external links in new tab</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">site</span> <span class="comment"># Apply to the whole site</span></span><br><span class="line">  <span class="attr">exclude:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">filename_case:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">render_drafts:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">relative_link:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">future:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">highlight:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">line_number:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">auto_detect:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">tab_replace:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">wrap:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">hljs:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">prismjs:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">preprocess:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">line_number:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">tab_replace:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Home page setting</span></span><br><span class="line"><span class="comment"># path: Root path for your blogs index page. (default = &#x27;&#x27;)</span></span><br><span class="line"><span class="comment"># per_page: Posts displayed per page. (0 = disable pagination)</span></span><br><span class="line"><span class="comment"># order_by: Posts order. (Order by date descending by default)</span></span><br><span class="line"><span class="attr">index_generator:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">per_page:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">order_by:</span> <span class="string">-date</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Category &amp; Tag</span></span><br><span class="line"><span class="attr">default_category:</span> <span class="string">uncategorized</span></span><br><span class="line"><span class="attr">category_map:</span></span><br><span class="line"><span class="attr">tag_map:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Metadata elements</span></span><br><span class="line"><span class="comment">## https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta</span></span><br><span class="line"><span class="attr">meta_generator:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># Date / Time format</span></span><br><span class="line"><span class="comment">## Hexo uses Moment.js to parse and display date</span></span><br><span class="line"><span class="comment">## You can customize the date format as defined in</span></span><br><span class="line"><span class="comment">## http://momentjs.com/docs/#/displaying/format/</span></span><br><span class="line"><span class="attr">date_format:</span> <span class="string">YYYY-MM-DD</span></span><br><span class="line"><span class="attr">time_format:</span> <span class="string">HH:mm:ss</span></span><br><span class="line"><span class="comment">## updated_option supports &#x27;mtime&#x27;, &#x27;date&#x27;, &#x27;empty&#x27;</span></span><br><span class="line"><span class="attr">updated_option:</span> <span class="string">&quot;mtime&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pagination</span></span><br><span class="line"><span class="comment">## Set per_page to 0 to disable pagination</span></span><br><span class="line"><span class="attr">per_page:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">pagination_dir:</span> <span class="string">page</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="comment"># theme: landscape</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">BlueLake</span></span><br><span class="line"><span class="attr">stylus:</span></span><br><span class="line">  <span class="attr">compress:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># json local search</span></span><br><span class="line"><span class="attr">jsonContent:</span></span><br><span class="line">  <span class="attr">meta:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">pages:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">posts:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">date:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">path:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">text:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">raw:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">content:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">slug:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">updated:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">comments:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">link:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">permalink:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">excerpt:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">categories:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tags:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://github.com/lixxu/lixxu.github.io</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">live2d:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">scriptFrom:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">pluginRootPath:</span> <span class="string">live2dw/</span></span><br><span class="line">  <span class="attr">pluginJsPath:</span> <span class="string">lib/</span></span><br><span class="line">  <span class="attr">pluginModelPath:</span> <span class="string">assets/</span></span><br><span class="line">  <span class="attr">tagMode:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">log:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">model:</span></span><br><span class="line">    <span class="attr">use:</span> <span class="string">live2d-widget-model-wanko</span></span><br><span class="line">  <span class="attr">display:</span></span><br><span class="line">    <span class="attr">width:</span> <span class="number">300</span></span><br><span class="line">    <span class="attr">height:</span> <span class="number">600</span></span><br><span class="line">    <span class="attr">position:</span> <span class="string">right</span></span><br><span class="line">    <span class="attr">hOffset:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">vOffset:</span> <span class="number">-20</span></span><br><span class="line">  <span class="attr">mobile:</span></span><br><span class="line">    <span class="attr">show:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">scale:</span> <span class="number">0.5</span></span><br><span class="line">  <span class="attr">react:</span></span><br><span class="line">    <span class="attr">opacityDefault:</span> <span class="number">0.7</span></span><br><span class="line">    <span class="attr">opacityOnHover:</span> <span class="number">0.2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>主题配置文件:</p><figure class="highlight yaml"><figcaption><span>themes\BlueLake\_config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##########################</span></span><br><span class="line"><span class="comment">## Site Config Settings ##</span></span><br><span class="line"><span class="comment">##########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Theme version</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">3.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Theme tone</span></span><br><span class="line"><span class="attr">dark:</span> <span class="literal">true</span> <span class="comment"># true/false</span></span><br><span class="line"><span class="attr">favicon:</span> <span class="string">/favicon.png</span></span><br><span class="line"><span class="attr">banner:</span> <span class="string">&quot;images/banner.jpg&quot;</span></span><br><span class="line"><span class="attr">banner-dark:</span> <span class="string">&quot;images/banner-dark.jpg&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Header</span></span><br><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">page:</span> <span class="string">home</span></span><br><span class="line">    <span class="attr">directory:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fa-home</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">page:</span> <span class="string">archive</span></span><br><span class="line">    <span class="attr">directory:</span> <span class="string">archives/</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fa-archive</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">page:</span> <span class="string">about</span></span><br><span class="line">    <span class="attr">directory:</span> <span class="string">about/</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fa-user</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">page:</span> <span class="string">rss</span></span><br><span class="line">    <span class="attr">directory:</span> <span class="string">atom.xml</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fa-rss</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RSS &amp; Sitemap plugins</span></span><br><span class="line"><span class="attr">Plugins:</span> <span class="string">hexo-generator-feed</span></span><br><span class="line">  <span class="string">hexo-generator-sitemap</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sitemap</span></span><br><span class="line"><span class="attr">sitemap:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">sitemap.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Content</span></span><br><span class="line"><span class="attr">excerpt_link:</span> <span class="string">阅读更多</span></span><br><span class="line"><span class="attr">excerpt:</span></span><br><span class="line">  <span class="attr">depth:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">excerpt_excludes:</span> []</span><br><span class="line">  <span class="attr">more_excludes:</span> []</span><br><span class="line">  <span class="attr">hideWholePostExcerpts:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">fancybox:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">copyright:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># display article copyright information, true/false.</span></span><br><span class="line">  <span class="attr">content:</span> <span class="string">&quot;转载请注明出处.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Date_formats</span></span><br><span class="line"><span class="attr">date_formats:</span></span><br><span class="line">  <span class="attr">post:</span> <span class="string">&quot;YYYY年MM月DD日&quot;</span></span><br><span class="line">  <span class="attr">idStr:</span> <span class="string">&quot;YYYYMMDDHHmmss&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sidebar</span></span><br><span class="line"><span class="attr">sidebar:</span> <span class="string">right</span> <span class="comment"># right/left/bottom</span></span><br><span class="line"><span class="attr">widgets:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">recent_posts</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">tagcloud</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">category</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">archive</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">tag</span></span><br><span class="line">  <span class="comment"># - links</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Widget behavior</span></span><br><span class="line"><span class="attr">archive_type:</span> <span class="string">&quot;yearly&quot;</span> <span class="comment"># &#x27;yearly&#x27;,&#x27;monthly&#x27;</span></span><br><span class="line"><span class="attr">archive_format:</span> <span class="string">&quot;YYYY年&quot;</span> <span class="comment"># &#x27;YYYY年&#x27;,&#x27;YYYY年MM月&#x27;</span></span><br><span class="line"><span class="attr">show_count:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">recent_posts_limits:</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Toc</span></span><br><span class="line"><span class="attr">toc:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">list_number:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Article share</span></span><br><span class="line"><span class="attr">share:</span></span><br><span class="line">  <span class="attr">local_share:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">baidu_share:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Miscellaneous</span></span><br><span class="line"><span class="attr">busuanzi:</span> <span class="literal">false</span> <span class="comment">## If you want to use Busuanzi page views please set the value to true.</span></span><br><span class="line"><span class="attr">baidu_analytics:</span></span><br><span class="line"><span class="attr">google_analytics:</span></span><br><span class="line"><span class="attr">gauges_analytics:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MathJax support</span></span><br><span class="line"><span class="attr">mathjax:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span> <span class="comment"># true/false.</span></span><br><span class="line">  <span class="attr">cdn:</span> <span class="string">//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reward</span></span><br><span class="line"><span class="attr">reward:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span> <span class="comment"># true/false 是否开启 打赏功能</span></span><br><span class="line">  <span class="attr">wechat:</span> <span class="string">&quot;/css/images/wechat-pay.jpg&quot;</span></span><br><span class="line">  <span class="attr">alipay:</span> <span class="string">&quot;/css/images/alipay-pay.jpg&quot;</span></span><br><span class="line">  <span class="attr">buttonTxt:</span> <span class="string">&quot;打赏&quot;</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">&quot;“感谢你的支持，我会继续努力！”&quot;</span></span><br><span class="line">  <span class="attr">content:</span> <span class="string">&quot;扫码打赏，感谢支持&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># About page</span></span><br><span class="line"><span class="attr">about:</span></span><br><span class="line">  <span class="attr">photo_url:</span> <span class="string">https://avatars2.githubusercontent.com/u/264487?s=256&amp;amp;u=04c0bc38daccfed43fc513efe5ac8440891e6029&amp;amp;v=4</span> <span class="comment">## Your photo e.g. /themeauthor.jpg</span></span><br><span class="line">  <span class="attr">items:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">label:</span> <span class="string">email</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">mailto:xuzenglin@gmail.com</span> <span class="comment">## Your email with mailto: e.g.  mailto:chaoles@foxmail.com</span></span><br><span class="line">      <span class="attr">title:</span> <span class="string">xuzenglin@gmail.com</span> <span class="comment">## Your email e.g.  chaoles@foxmail.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">label:</span> <span class="string">github</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">https://github.com/lixxu</span> <span class="comment">## Your github&#x27;url e.g.  https://github.com/chaooo</span></span><br><span class="line">      <span class="attr">title:</span> <span class="string">lix</span> <span class="comment">## Your github&#x27;name e.g.  chaooo</span></span><br><span class="line">    <span class="comment"># - label: weibo</span></span><br><span class="line">    <span class="comment">#   url: ## Your weibo&#x27;s url e.g.  http://weibo.com/zhengchaooo</span></span><br><span class="line">    <span class="comment">#   title: ## Your weibo&#x27;s name e.g.  秋过冬漫长</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Gitalk comment</span></span><br><span class="line"><span class="attr">gitalk:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">owner:</span> <span class="string">lixxu</span> <span class="comment">## Your GitHub ID, e.g. username</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">lixxu.github.io</span> <span class="comment">## The repository to store your comments, make sure you&#x27;re the repo&#x27;s owner, e.g. gitalk.github.io</span></span><br><span class="line">  <span class="attr">client_id:</span> <span class="comment">## GitHub client ID, e.g. 75752dafe7907a897619</span></span><br><span class="line">  <span class="attr">client_secret:</span> <span class="comment">## GitHub client secret, e.g. ec2fb9054972c891289640354993b662f4cccc50</span></span><br><span class="line">  <span class="attr">admin:</span> <span class="comment">## Github repo owner and collaborators, only these guys can initialize github issues.</span></span><br><span class="line">  <span class="attr">language:</span> <span class="string">&quot;zh-CN&quot;</span> <span class="comment">## Language</span></span><br><span class="line">  <span class="attr">pagerDirection:</span> <span class="string">last</span> <span class="comment"># Comment sorting direction, available values are last and first.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># giteement评论（基于Gitee issues）【！！！慎用，Gitee接口调用时好像有次数限制，导致后面无法调试，若要使用请自行研究】</span></span><br><span class="line"><span class="attr">giteement:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">owner:</span> <span class="comment">#&#x27;chaoo&#x27;  # 你的码云账号英文名</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="comment">#&#x27;blog-comments&#x27; # 存储评论的仓库的仓库名称(需要在码云仓库创建公开仓库)</span></span><br><span class="line">  <span class="attr">redirect_uri:</span> <span class="comment">#&#x27;https://chaoo.gitee.io&#x27;   # 应用回调地址(请和配置的第三方应用保持一致)</span></span><br><span class="line">  <span class="attr">client_id:</span> <span class="comment">#4ec96c34e83a4767d762a5a321ae15d9b8456d552c146afda829b815d51abfd2 ## GitHub client ID, e.g. 75752dafe7907a897619</span></span><br><span class="line">  <span class="attr">client_secret:</span> <span class="comment">#d2cf268817c7099b010f4ff7053f79dca3e32105da449318d8ae87f82782d531 ## GitHub client secret, e.g. ec2fb9054972c891289640354993b662f4cccc50</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Valine comment. https://valine.js.org</span></span><br><span class="line"><span class="attr">valine:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span> <span class="comment"># if you want use valine,please set this value is true</span></span><br><span class="line">  <span class="attr">appId:</span> <span class="comment"># leancloud application app id</span></span><br><span class="line">  <span class="attr">appKey:</span> <span class="comment"># leancloud application app key</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="literal">false</span> <span class="comment"># valine mail notify (true/false) https://github.com/xCss/Valine/wiki</span></span><br><span class="line">  <span class="attr">verify:</span> <span class="literal">false</span> <span class="comment"># valine verify code (true/false)</span></span><br><span class="line">  <span class="attr">pageSize:</span> <span class="number">10</span> <span class="comment"># comment list page size</span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="string">mm</span> <span class="comment"># gravatar style https://valine.js.org/#/avatar</span></span><br><span class="line">  <span class="attr">lang:</span> <span class="string">zh-cn</span> <span class="comment"># i18n: zh-cn/en</span></span><br><span class="line">  <span class="attr">placeholder:</span> <span class="string">Just</span> <span class="string">go</span> <span class="string">go</span> <span class="comment"># valine comment input placeholder(like: Please leave your footprints )</span></span><br><span class="line">  <span class="attr">guest_info:</span> <span class="string">nick,mail,link</span> <span class="comment">#valine comment header info</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Changyan comment. 畅言</span></span><br><span class="line"><span class="attr">changyan:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">appid:</span> <span class="comment">## changyan appid</span></span><br><span class="line">  <span class="attr">appkey:</span> <span class="comment">## changyan appkey</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Other comments</span></span><br><span class="line"><span class="attr">comment:</span></span><br><span class="line">  <span class="attr">disqus:</span> <span class="comment">## disqus_shortname</span></span><br><span class="line">  <span class="attr">livere:</span> <span class="comment">## 来必力(data-uid)</span></span><br><span class="line">  <span class="attr">uyan:</span> <span class="comment">## 友言(uid)</span></span><br><span class="line">  <span class="attr">cloudTie:</span> <span class="comment">## 网易云跟帖(productKey)</span></span><br><span class="line">  <span class="attr">utterances:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">repo:</span> <span class="string">lixxu/lixxu.github.io</span></span><br><span class="line">    <span class="attr">issue_term:</span> <span class="string">pathname</span> <span class="comment"># pathname, url, title, og:title [ISSUE NUMBER] or [SPECIFIC TERM]</span></span><br><span class="line">    <span class="attr">theme:</span> <span class="string">github-light</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">auto_excerpt:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">lines:</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Friend Links widget. Empty links will hide widget.</span></span><br><span class="line"><span class="attr">links:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">title:</span> <span class="string">site-name1</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://www.example1.com/</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">title:</span> <span class="string">site-name2</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://www.example2.com/</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">title:</span> <span class="string">site-name3</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://www.example3.com/</span></span><br></pre></td></tr></table></figure><p>自动添加 <code>read more</code> 修改的文件:</p><figure class="highlight html"><figcaption><span>themes\BlueLake\layout\_partial\article.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">article</span> <span class="attr">id</span>=<span class="string">&quot;&lt;%= post.layout %&gt;-&lt;%= post.slug %&gt;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;h-entry article article-type-&lt;%= post.layout %&gt;&quot;</span> <span class="attr">itemprop</span>=<span class="string">&quot;blogPost&quot;</span> <span class="attr">itemscope</span> <span class="attr">itemtype</span>=<span class="string">&quot;https://schema.org/BlogPosting&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;article-inner&quot;</span>&gt;</span></span><br><span class="line">    &lt;%- partial(&#x27;post/gallery&#x27;) %&gt;</span><br><span class="line">    &lt;% if (post.link || post.title)&#123; %&gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;article-header&quot;</span>&gt;</span></span><br><span class="line">        &lt;%- partial(&#x27;post/title&#x27;, &#123;class_name: &#x27;p-name article-title&#x27;&#125;) %&gt;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;article-meta&quot;</span>&gt;</span></span><br><span class="line">      &lt;% if (post.top)&#123; %&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&#x27;article-top&#x27;</span>&gt;</span>【&lt;%- __(&#x27;topped&#x27;) %&gt;】<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      &lt;% &#125; %&gt;</span><br><span class="line">      &lt;%- partial(&#x27;post/date&#x27;, &#123;class_name: &#x27;article-date&#x27;, date_format: theme.date_formats.post &#125;) %&gt;</span><br><span class="line">      &lt;%- partial(&#x27;post/category&#x27;) %&gt;</span><br><span class="line">      &lt;% if (!index)&#123; %&gt;</span><br><span class="line">        &lt;%- partial(&#x27;post/views-count&#x27;) %&gt;</span><br><span class="line">      &lt;% &#125; %&gt;</span><br><span class="line">      &lt;%- partial(&#x27;post/comments-count&#x27;) %&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;e-content article-entry&quot;</span> <span class="attr">itemprop</span>=<span class="string">&quot;articleBody&quot;</span>&gt;</span></span><br><span class="line">      &lt;% var show_all_content = true %&gt;</span><br><span class="line">      &lt;% if (index)&#123; %&gt;</span><br><span class="line">        &lt;% if (post.excerpt)&#123; %&gt;</span><br><span class="line">          &lt;% show_all_content = false %&gt;</span><br><span class="line">          &lt;%- post.excerpt %&gt;</span><br><span class="line">        &lt;% &#125; else if (theme.auto_excerpt.enable &amp;&amp; index) &#123; %&gt;</span><br><span class="line">          &lt;% var br_pos = 0 %&gt;</span><br><span class="line">          &lt;% for (var br_count = 0; br_count &lt; theme.auto_excerpt.lines; br_count++) &#123; %&gt;</span><br><span class="line">            &lt;% br_pos = post.content.indexOf(&#x27;\n&#x27;,br_pos + 1) %&gt;</span><br><span class="line">            &lt;% if(br_pos &lt; 0) &#123; break &#125; %&gt;</span><br><span class="line">          &lt;% &#125; %&gt;</span><br><span class="line">          &lt;% if(br_pos &gt; 0) &#123; %&gt;</span><br><span class="line">            &lt;% show_all_content = false %&gt;</span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>&lt;%- post.content.substring(0, br_pos + 1) %&gt;<span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">          &lt;% &#125; %&gt;</span><br><span class="line">        &lt;% &#125; %&gt;</span><br><span class="line">      &lt;% &#125; else &#123; %&gt;</span><br><span class="line">        &lt;%- post.content %&gt;</span><br><span class="line">        &lt;% if (!index)&#123; %&gt;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc-article&quot;</span>&gt;</span></span><br><span class="line">                &lt;%- partial(&#x27;post/toc&#x27;) %&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        &lt;% &#125; %&gt;</span><br><span class="line">        &lt;% if (theme.copyright.enable)&#123; %&gt;</span><br><span class="line">          <span class="tag">&lt;<span class="name">blockquote</span> <span class="attr">id</span>=<span class="string">&quot;copyright&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">p</span>&gt;</span>&lt;%= __(&quot;copyright_link&quot;) %&gt;: <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%- url_for(config.url +&#x27;/&#x27;+ page.path) %&gt;&quot;</span>&gt;</span>&lt;%- url_for(config.url +&#x27;/&#x27;+ page.path) %&gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">p</span>&gt;</span>&lt;%= __(&quot;copyright_notice&quot;) %&gt;: &lt;%= theme.copyright.content %&gt;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">blockquote</span>&gt;</span></span><br><span class="line">        &lt;% &#125; %&gt;</span><br><span class="line">      &lt;% &#125; %&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;article-footer&quot;</span>&gt;</span></span><br><span class="line">      &lt;% if (!show_all_content || (post.excerpt &amp;&amp; index &amp;&amp; theme.excerpt_link))&#123; %&gt;</span><br><span class="line">        &lt;%- partial(&#x27;post/tag&#x27;) %&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;article-more-link&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%- url_for(post.path) %&gt;#more&quot;</span>&gt;</span>&lt;%= theme.excerpt_link %&gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      &lt;% &#125; else &#123; %&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;article-tag-wrap&quot;</span>&gt;</span></span><br><span class="line">          &lt;%- partial(&#x27;post/reward&#x27;) %&gt;</span><br><span class="line">          &lt;%- partial(&#x27;post/tag&#x27;) %&gt;</span><br><span class="line">          &lt;%- partial(&#x27;post/share&#x27;) %&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      &lt;% &#125; %&gt;</span><br><span class="line">      &lt;% if (!index)&#123; %&gt;</span><br><span class="line">        &lt;%- partial(&#x27;post/nav&#x27;) %&gt;</span><br><span class="line">      &lt;% &#125; %&gt;</span><br><span class="line">      &lt;% if (!index)&#123; %&gt;</span><br><span class="line">        &lt;%- partial(&#x27;post/comments&#x27;) %&gt;</span><br><span class="line">      &lt;% &#125; %&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br></pre></td></tr></table></figure><p>about文件</p><figure class="highlight html"><figcaption><span>themes\BlueLake\layout\_partial\about.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">article</span> <span class="attr">id</span>=<span class="string">&quot;&lt;%= post.layout %&gt;-&lt;%= post.slug %&gt;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;h-entry article article-type-&lt;%= post.layout %&gt;&quot;</span> <span class="attr">itemprop</span>=<span class="string">&quot;blogPost&quot;</span> <span class="attr">itemscope</span> <span class="attr">itemtype</span>=<span class="string">&quot;https://schema.org/BlogPosting&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;article-inner&quot;</span>&gt;</span></span><br><span class="line">    &lt;%- partial(&#x27;post/gallery&#x27;) %&gt;</span><br><span class="line">    &lt;% if (post.link || post.title)&#123; %&gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;article-header&quot;</span>&gt;</span></span><br><span class="line">        &lt;%- partial(&#x27;post/title&#x27;, &#123;class_name: &#x27;p-name article-title&#x27;&#125;) %&gt;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;e-content article-entry&quot;</span> <span class="attr">itemprop</span>=<span class="string">&quot;articleBody&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;author-page&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;photo&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%= theme.about.photo_url %&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user&quot;</span>&gt;</span>name：<span class="tag">&lt;/<span class="name">i</span>&gt;</span>&lt;%= config.author %&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          &lt;% theme.about.items.forEach(function(item, i)&#123; %&gt;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-&lt;%= item.label %&gt;&quot;</span>&gt;</span>&lt;%= item.label %&gt;：<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%= item.url %&gt;&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>&lt;%= item.title %&gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          &lt;% &#125;) %&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        &lt;%- post.content %&gt;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      &lt;% if (!index &amp;&amp; post.comments)&#123; %&gt;</span><br><span class="line">        &lt;%- partial(&#x27;post/comments&#x27;) %&gt;</span><br><span class="line">      &lt;% &#125; %&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br></pre></td></tr></table></figure><p>utterances评论修改的文件:</p><figure class="highlight html"><figcaption><span>themes\BlueLake\layout\_partial\post\comments-count.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if (post.comments)&#123; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%- url_for(post.path) %&gt;#comments&quot;</span> <span class="attr">class</span>=<span class="string">&quot;article-comment-link&quot;</span>&gt;</span></span><br><span class="line">  &lt;% if (!index)&#123; %&gt;</span><br><span class="line">    &lt;% if (theme.valine.enable &amp;&amp; theme.valine.appId &amp;&amp; theme.valine.appKey)&#123; %&gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-comments-count valine-comment-count&quot;</span> <span class="attr">data-xid</span>=<span class="string">&quot;&lt;%- url_for(post.path) %&gt;&quot;</span> <span class="attr">itemprop</span>=<span class="string">&quot;commentCount&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">    &lt;% if (theme.comment.disqus)&#123; %&gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;disqus-comment-count&quot;</span> <span class="attr">data-disqus-identifier</span>=<span class="string">&quot;&lt;%- url_for(post.path) %&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">    &lt;% if (theme.comment.utterances)&#123; %&gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%- url_for(post.path) %&gt;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;utterances_count_unit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">    &lt;% if (theme.comment.uyan)&#123; %&gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%- url_for(post.path) %&gt;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;uyan_count_unit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">    &lt;% if (theme.comment.cloudTie)&#123; %&gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;cloud-tie-join-count&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;join-count&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">    &lt;% if (theme.changyan.enable &amp;&amp; theme.changyan.appid &amp;&amp; theme.changyan.appkey)&#123; %&gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">id</span>=<span class="string">&quot;changyan_count_unit&quot;</span> <span class="attr">data-xid</span>=<span class="string">&quot;&lt;%- url_for(post.path) %&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">  &lt;% &#125; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-commt&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  &lt;%= __(&#x27;guestbook&#x27;) %&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><figure class="highlight html"><figcaption><span>themes\BlueLake\layout\_partial\post\comments.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if (theme.gitalk.enable &amp;&amp; theme.gitalk.client_id &amp;&amp; theme.gitalk.client_secret)&#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;comments&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;% if (theme.giteement.enable &amp;&amp; theme.giteement.client_id &amp;&amp; theme.giteement.client_secret)&#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;comments&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;% if (theme.valine.enable &amp;&amp; theme.valine.appId &amp;&amp; theme.valine.appKey)&#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">&quot;comments&quot;</span> <span class="attr">class</span>=<span class="string">&quot;vcomment&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;% if (theme.comment.disqus)&#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;comments&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;disqus_thread&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;% if (theme.comment.livere)&#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;comments&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;lv-container&quot;</span> <span class="attr">data-uid</span>=<span class="string">&quot;&lt;%= theme.comment.livere %&gt;&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;city&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;% if (theme.comment.uyan)&#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;comments&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;uyan_frame&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;% if (theme.comment.cloudTie)&#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;comments&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;cloud-tie-wrapper&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cloud-tie-wrapper&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;% if (theme.changyan.enable &amp;&amp; theme.changyan.appid &amp;&amp; theme.changyan.appkey)&#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;comments&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;SOHUCS&quot;</span> <span class="attr">sid</span>=<span class="string">&quot;&lt;%= page.path %&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;% if (theme.comment.utterances.enable &amp;&amp; theme.comment.utterances.repo &amp;&amp; theme.comment.utterances.issue_term)&#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;comments&quot;</span> <span class="attr">class</span>=<span class="string">&quot;comments&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://utteranc.es/client.js&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">repo</span>=<span class="string">&quot;&lt;%= theme.comment.utterances.repo %&gt;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">issue-term</span>=<span class="string">&quot;&lt;%= theme.comment.utterances.issue_term %&gt;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">theme</span>=<span class="string">&quot;&lt;%= theme.comment.utterances.theme %&gt;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">async</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>自定义评论主题css</p><figure class="highlight css"><figcaption><span>themes\BlueLake\source\css\style.styl</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-class">.utterances</span></span><br><span class="line">  <span class="attribute">max-width</span>: none</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>先就这样吧.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;参考来源:&lt;br&gt;&lt;a href=&quot;https://blog.zthxxx.me/post/hexo-automatic-add-readmore/&quot;&gt;https://blog.zthxxx.me/post/hexo-automatic-add-readmore/&lt;/a&gt;&lt;</summary>
      
    
    
    
    
    <category term="hexo bluelake readmore excerpt" scheme="http://lixxu.github.io/tags/hexo-bluelake-readmore-excerpt/"/>
    
  </entry>
  
  <entry>
    <title>使用 utterances 作为评论系统</title>
    <link href="http://lixxu.github.io/2019/03/20/use-utterances-comment/"/>
    <id>http://lixxu.github.io/2019/03/20/use-utterances-comment/</id>
    <published>2019-03-20T08:36:10.000Z</published>
    <updated>2023-01-09T01:39:09.177Z</updated>
    
    <content type="html"><![CDATA[<p>参考来源: <a href="https://wangjiezhe.com/posts/2018-10-29-Hexo-NexT-3/">https://wangjiezhe.com/posts/2018-10-29-Hexo-NexT-3/</a></p><p>今天在 <a href="http://weekly.pychina.org/issue/issue-359.html">蟒周刊</a> 里看到使用了 <a href="https://utteranc.es/">utterances</a> 作为评论系统, 网上查了一下, 原来是基于 <code>github</code> 的. 于是我也跟风配置了一下, 就不用 <a href="https://disqus.com/">disqus</a> 了, 毕竟只能用梯子才能访问.</p><p>由于我用的是 <a href="https://github.com/chaooo/hexo-theme-BlueLake">BlueLake</a>, 里面的模板用的是 <a href="http://jade-lang.com/">Jade</a>, 根本不熟悉 (好像新版用 <a href="https://pugjs.org/api/getting-started.html">pug</a> 代替 <code>Jade</code> 了). 在 <a href="https://stackoverflow.com/questions/8698534/how-to-pass-variable-from-jade-template-file-to-a-script-file">SO</a>看到传递参数的语法是 <code>#&#123;variable_name&#125;</code>.</p><p>最后, 总算搞定了.</p><ol><li><p>在文件 <code>themes\BlueLake\layout\_partial\comments.jade</code> 的最后添加</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">if theme.comment.utterances.enable</span><br><span class="line">  #comments.comments</span><br><span class="line">    script(type=&quot;text/javascript&quot;,src=&quot;https://utteranc.es/client.js&quot;,charset=&quot;utf-8&quot;,repo=&quot;#&#123;theme.comment.utterances.repo&#125;&quot;,issue-term=&quot;#&#123;theme.comment.utterances.issue_term&#125;&quot;,theme=&quot;#&#123;theme.comment.utterances.theme&#125;&quot;,crossorigin=&quot;anonymous&quot;,async=true)</span><br></pre></td></tr></table></figure></li><li><p>打开主题评论的配置选项:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">comment:</span><br><span class="line">  duoshuo: #chaooo ## duoshuo_shortname</span><br><span class="line">  disqus: ## disqus_shortname</span><br><span class="line">  livere: ## 来必力(data-uid)</span><br><span class="line">  uyan: ## 友言(uid)</span><br><span class="line">  cloudTie: ## 网易云跟帖(productKey)</span><br><span class="line">  utterances:</span><br><span class="line">    enable: true</span><br><span class="line">    repo: owner/repo</span><br><span class="line">    issue_term: pathname # pathname, url, title, og:title [ISSUE NUMBER] or [SPECIFIC TERM]</span><br><span class="line">    theme: github-light</span><br><span class="line">  changyan: ## 畅言需在下方配置两个参数，此处不填。</span><br><span class="line">    appid: ## 畅言(appid)</span><br><span class="line">    appkey: ##畅言(appkey)</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;参考来源: &lt;a href=&quot;https://wangjiezhe.com/posts/2018-10-29-Hexo-NexT-3/&quot;&gt;https://wangjiezhe.com/posts/2018-10-29-Hexo-NexT-3/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;今天在 </summary>
      
    
    
    
    <category term="blog" scheme="http://lixxu.github.io/categories/blog/"/>
    
    
    <category term="utterances" scheme="http://lixxu.github.io/tags/utterances/"/>
    
    <category term="jade" scheme="http://lixxu.github.io/tags/jade/"/>
    
    <category term="pug" scheme="http://lixxu.github.io/tags/pug/"/>
    
  </entry>
  
  <entry>
    <title>忽略 pip 在 python2.7 上的废弃警告</title>
    <link href="http://lixxu.github.io/2019/03/07/ignore-pip-upgrade-deprecation/"/>
    <id>http://lixxu.github.io/2019/03/07/ignore-pip-upgrade-deprecation/</id>
    <published>2019-03-07T04:42:41.000Z</published>
    <updated>2023-01-07T08:37:41.946Z</updated>
    
    <content type="html"><![CDATA[<p>新版的 <code>pip</code> 在 <code>python2.7</code> 上使用时, 会显示废弃的信息.</p><img src="/2019/03/07/ignore-pip-upgrade-deprecation/pip.png" class=""><p>看着比较烦人, 网上有解决方案 <a href="https://github.com/pypa/pip/pull/6147#issuecomment-457910432">https://github.com/pypa/pip/pull/6147#issuecomment-457910432</a>.</p><p>具体做法是:<br>新建一个 <code>PYTHONWARNINGS</code> 的环境变量, 值设为 <code>ignore:DEPRECATION::pip._internal.cli.base_command</code>, <code>Windows</code> 下两边没有双引号, 其他平台可能需要.</p><p>重新启动命令行, 再跑一下, 应该就没有了.</p><img src="/2019/03/07/ignore-pip-upgrade-deprecation/pip_ok.png" class="">]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;新版的 &lt;code&gt;pip&lt;/code&gt; 在 &lt;code&gt;python2.7&lt;/code&gt; 上使用时, 会显示废弃的信息.&lt;/p&gt;
&lt;img src=&quot;/2019/03/07/ignore-pip-upgrade-deprecation/pip.png&quot; class=&quot;&quot;&gt;</summary>
      
    
    
    
    <category term="python" scheme="http://lixxu.github.io/categories/python/"/>
    
    
    <category term="python" scheme="http://lixxu.github.io/tags/python/"/>
    
    <category term="pip" scheme="http://lixxu.github.io/tags/pip/"/>
    
  </entry>
  
  <entry>
    <title>jQuery Chosen异常CSS的修复</title>
    <link href="http://lixxu.github.io/2019/03/04/jquery-chosen-css/"/>
    <id>http://lixxu.github.io/2019/03/04/jquery-chosen-css/</id>
    <published>2019-03-04T01:30:41.000Z</published>
    <updated>2023-01-07T08:37:41.945Z</updated>
    
    <content type="html"><![CDATA[<p>背景:</p><ol><li>jquery 3.3.1</li><li>chosen 1.8.7</li><li>bootstrap 3.4.1</li></ol><span id="more"></span><p>在使用 <a href="https://harvesthq.github.io/chosen/">chosen</a> 时, 在给选择框加错误提示时, 边框的颜色没有变:</p><img src="/2019/03/04/jquery-chosen-css/no-border-error.png" class=""><p>研究了一下, 最后参考 SO 上的答案, 在自定义的 CSS 文件里加入以下几行:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.chosen-container-single</span> <span class="selector-class">.chosen-single</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">38px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">38px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.chosen-container-single</span> <span class="selector-class">.chosen-single</span> <span class="selector-tag">div</span> <span class="selector-tag">b</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">chosen-sprite.png</span>) no-repeat <span class="number">0</span> <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.chosen-container-single</span> <span class="selector-class">.chosen-search</span> <span class="selector-tag">input</span><span class="selector-attr">[type=text]</span> &#123;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">36px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.form-group</span><span class="selector-class">.has-error</span> <span class="selector-tag">div</span> <span class="selector-tag">div</span> <span class="selector-tag">a</span><span class="selector-class">.chosen-single</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#b94a48</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后的显示算是正常了:</p><img src="/2019/03/04/jquery-chosen-css/ok.png" class=""><p>注意: 这个方法在 <code>bootstrap4</code> 上无效.</p><!--more-->]]></content>
    
    
    <summary type="html">&lt;p&gt;背景:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;jquery 3.3.1&lt;/li&gt;
&lt;li&gt;chosen 1.8.7&lt;/li&gt;
&lt;li&gt;bootstrap 3.4.1&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="web" scheme="http://lixxu.github.io/categories/web/"/>
    
    
    <category term="jquery" scheme="http://lixxu.github.io/tags/jquery/"/>
    
    <category term="chosen" scheme="http://lixxu.github.io/tags/chosen/"/>
    
  </entry>
  
  <entry>
    <title>添加萌萌哒</title>
    <link href="http://lixxu.github.io/2019/02/20/add-mengmengda/"/>
    <id>http://lixxu.github.io/2019/02/20/add-mengmengda/</id>
    <published>2019-02-20T07:02:44.000Z</published>
    <updated>2023-01-07T08:37:41.945Z</updated>
    
    <content type="html"><![CDATA[<p>参考 <a href="https://www.simon96.online/2018/10/12/hexo-tutorial/">https://www.simon96.online/2018/10/12/hexo-tutorial/</a>, 在页面上添加萌萌哒.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;参考 &lt;a href=&quot;https://www.simon96.online/2018/10/12/hexo-tutorial/&quot;&gt;https://www.simon96.online/2018/10/12/hexo-tutorial/&lt;/a&gt;, 在页面上添加萌萌哒.&lt;/p</summary>
      
    
    
    
    <category term="blog" scheme="http://lixxu.github.io/categories/blog/"/>
    
    
    <category term="blog" scheme="http://lixxu.github.io/tags/blog/"/>
    
  </entry>
  
  <entry>
    <title>使用新图床</title>
    <link href="http://lixxu.github.io/2019/02/20/use-new-image-server/"/>
    <id>http://lixxu.github.io/2019/02/20/use-new-image-server/</id>
    <published>2019-02-20T05:46:33.000Z</published>
    <updated>2023-01-07T08:37:41.945Z</updated>
    
    <content type="html"><![CDATA[<p>这几年发生了许多事, 导致好久没写了. 现在想再拾起来, 发现图片都不能用了, 也没法下载了, 发了工单, 恢复倒是挺快, 也按照说明把图片导出来了.</p><p>换到新 <a href="https://sm.ms/">https://sm.ms/</a> 了, 只能传图片, 暂时先这样吧, 后续有时间再折腾其他.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这几年发生了许多事, 导致好久没写了. 现在想再拾起来, 发现图片都不能用了, 也没法下载了, 发了工单, 恢复倒是挺快, 也按照说明把图片导出来了.&lt;/p&gt;
&lt;p&gt;换到新 &lt;a href=&quot;https://sm.ms/&quot;&gt;https://sm.ms/&lt;/a&gt; 了, 只能传</summary>
      
    
    
    
    <category term="blog" scheme="http://lixxu.github.io/categories/blog/"/>
    
    
    <category term="blog" scheme="http://lixxu.github.io/tags/blog/"/>
    
  </entry>
  
  <entry>
    <title>保存 git 密码</title>
    <link href="http://lixxu.github.io/2017/12/20/save-git-password/"/>
    <id>http://lixxu.github.io/2017/12/20/save-git-password/</id>
    <published>2017-12-20T08:27:28.000Z</published>
    <updated>2023-01-07T08:37:41.945Z</updated>
    
    <content type="html"><![CDATA[<p>每次 pull 仓库时, 都要输入密码, 太麻烦了. 记录保存一下 (明文存储的密码, 安全要求高的考虑其他方法吧).</p><p>文章来自于: <a href="https://stackoverflow.com/questions/5343068/is-there-a-way-to-skip-password-typing-when-using-https-on-github">https://stackoverflow.com/questions/5343068/is-there-a-way-to-skip-password-typing-when-using-https-on-github</a></p><p>You can also have Git store your credentials permanently using the following:</p><p><code>git config credential.helper store</code></p><p>Note: While this is convenient, Git will store your credentials in clear text in a local file (<code>.git-credentials</code>) under your project directory (see below for the “<code>home</code>“ directory). If you don’t like this, delete this file and switch to using the cache option.</p><p>If you want Git to resume to asking you for credentials every time it needs to connect to the remote repository, you can run this command:</p><p><code>git config --unset credential.helper</code><br>To store the passwords in <code>.git-credentials</code> in your <code>%HOME%</code> directory as opposed to the project directory: use the <code>--global</code> flag</p><p><code>git config --global credential.helper store</code></p><p>Windows 平台下可以使用 <a href="https://github.com/Microsoft/Git-Credential-Manager-for-Windows">https://github.com/Microsoft/Git-Credential-Manager-for-Windows</a>, 在第一次需要输入密码时会弹窗, 输入后下次就不用输入了.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;每次 pull 仓库时, 都要输入密码, 太麻烦了. 记录保存一下 (明文存储的密码, 安全要求高的考虑其他方法吧).&lt;/p&gt;
&lt;p&gt;文章来自于: &lt;a href=&quot;https://stackoverflow.com/questions/5343068/is-there-a</summary>
      
    
    
    
    
    <category term="git" scheme="http://lixxu.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>特殊的日子</title>
    <link href="http://lixxu.github.io/2017/11/14/special-days/"/>
    <id>http://lixxu.github.io/2017/11/14/special-days/</id>
    <published>2017-11-14T00:46:06.000Z</published>
    <updated>2023-01-07T08:37:41.944Z</updated>
    
    <content type="html"><![CDATA[<p>仅以此篇记录一些特殊的日子:</p><p><strong>2015-04-15</strong><br><strong>2015-04-16</strong><br><strong>2015-04-22</strong><br><strong>2015-04-29</strong><br><strong>2015-04-30</strong><br><strong>2015-06-01</strong><br><strong>2015-06-08</strong><br><strong>2015-08-31</strong><br><strong>2015-10-05</strong><br><strong>2017-03-29</strong><br><strong>2017-06-04</strong><br><strong>2018-10-01</strong><br><strong>end</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;仅以此篇记录一些特殊的日子:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2015-04-15&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;2015-04-16&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;2015-04-22&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;2015-04-29&lt;/st</summary>
      
    
    
    
    <category term="other" scheme="http://lixxu.github.io/categories/other/"/>
    
    
    <category term="other" scheme="http://lixxu.github.io/tags/other/"/>
    
  </entry>
  
  <entry>
    <title>转换到Hexo</title>
    <link href="http://lixxu.github.io/2017/11/10/use-hexo/"/>
    <id>http://lixxu.github.io/2017/11/10/use-hexo/</id>
    <published>2017-11-10T05:09:10.000Z</published>
    <updated>2023-01-07T08:37:41.944Z</updated>
    
    <content type="html"><![CDATA[<p>转了, 本考虑 <code>hugo</code>, 奈主题搞不定. 算了, 不折腾了, 用 <code>hexo</code> 了, 从 <code>octopress</code> 迁移也无痛.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;转了, 本考虑 &lt;code&gt;hugo&lt;/code&gt;, 奈主题搞不定. 算了, 不折腾了, 用 &lt;code&gt;hexo&lt;/code&gt; 了, 从 &lt;code&gt;octopress&lt;/code&gt; 迁移也无痛.&lt;/p&gt;
</summary>
      
    
    
    
    <category term="blog" scheme="http://lixxu.github.io/categories/blog/"/>
    
    
    <category term="hexo" scheme="http://lixxu.github.io/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>PostgreSQL 中删除重复记录</title>
    <link href="http://lixxu.github.io/2015/04/08/remove-duplicate-rows-from-postgresql/"/>
    <id>http://lixxu.github.io/2015/04/08/remove-duplicate-rows-from-postgresql/</id>
    <published>2015-04-08T03:20:20.000Z</published>
    <updated>2023-01-07T08:37:41.944Z</updated>
    
    <content type="html"><![CDATA[<p>来源: <a href="http://stackoverflow.com/questions/1746213/how-to-delete-duplicate-entries">http://stackoverflow.com/questions/1746213/how-to-delete-duplicate-entries</a></p><p>有的时候我们对一个表不会加唯一性限制, 而是在插入数据时进行检查. 但有的时候程序里的 bug 导致还是有重复的记录被插入到数据库中了, 这时候如何快速地删除重复行呢?</p><p>显然, 用程序来删除会比较耗时, 尤其是记录比较多的时候.<br>以下的方法只适用于 <code>PostgreSQL</code>, 因为不是标准的 SQL 语法.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">USING</span> <span class="keyword">table</span> alias</span><br><span class="line">  <span class="keyword">WHERE</span> table.field1 <span class="operator">=</span> alias.field1 <span class="keyword">AND</span> table.field2 <span class="operator">=</span> alias.field2 <span class="keyword">AND</span></span><br><span class="line">    table.max_field <span class="operator">&lt;</span> alias.max_field</span><br></pre></td></tr></table></figure><p>比如, 有一个用户表, email 字段本该是唯一的, 需要删除重复的 email 记录.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> user_accounts <span class="keyword">USING</span> user_accounts ua2</span><br><span class="line"><span class="keyword">WHERE</span> user_accounts.email <span class="operator">=</span> ua2.email <span class="keyword">AND</span> user_accounts.id <span class="operator">&lt;</span> ua2.id;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;来源: &lt;a href=&quot;http://stackoverflow.com/questions/1746213/how-to-delete-duplicate-entries&quot;&gt;http://stackoverflow.com/questions/1746213/how-t</summary>
      
    
    
    
    <category term="database" scheme="http://lixxu.github.io/categories/database/"/>
    
    
    <category term="database" scheme="http://lixxu.github.io/tags/database/"/>
    
    <category term="postgresql" scheme="http://lixxu.github.io/tags/postgresql/"/>
    
  </entry>
  
  <entry>
    <title>[转] Quake-III 代码里神奇的浮点开方函数</title>
    <link href="http://lixxu.github.io/2015/01/27/john-carmack/"/>
    <id>http://lixxu.github.io/2015/01/27/john-carmack/</id>
    <published>2015-01-27T12:05:42.000Z</published>
    <updated>2023-01-07T08:37:41.942Z</updated>
    
    <content type="html"><![CDATA[<p>源贴在这里 (也是转帖): <a href="http://www.douban.com/note/196653073/">http://www.douban.com/note/196653073/</a></p><img src="/2015/01/27/john-carmack/quake.jpg" class=""><p><code>Quake-III</code> 代码里神奇的浮点开方函数</p><p><code>Quake-III Arena (雷神之锤3)</code> 是90年代的经典游戏之一. 该系列的游戏不但画面和内容不错, 而且即使计算机配置低, 也能极其流畅地运行. 这要归功于它3D引擎的开发者<code>约翰-卡马克(John Carmack)</code>.</p><p>事实上早在90年代初DOS时代, 只要能在PC上搞个小动画都能让人惊叹一番的时候, <code>John Carmack</code> 就推出了石破天惊的<code>Castle Wolfstein</code>, 然后再接再励, <code>doom</code>, <code>doomII</code>, <code>Quake</code>…每次都把 3-D 技术推到极致. 他的3D引擎代码极度高效, 几乎是在压榨PC机的每条运算指令. 当初MS的 <code>Direct3D</code> 也得听取他的意见, 修改了不少API.</p><span id="more"></span><p>最近, QUAKE的开发商 <code>ID SOFTWARE</code> 遵守GPL协议, 公开了QUAKE-III的原代码, 让世人有幸目睹Carmack传奇的3D引擎的原码. 这是QUAKE-III原代码的下载地址:<br><a href="http://www.fileshack.com/file.x?fid=7547">http://www.fileshack.com/file.x?fid=7547</a></p><p>(下面是官方的下载网址, 搜索 <code>quake3-1.32b-source.zip</code> 可以找到一大堆中文网页的<br><a href="ftp://ftp.idsoftware.com/idstuff/source/quake3-1.32b-source.zip">ftp://ftp.idsoftware.com/idstuff/source/quake3-1.32b-source.zip</a>)</p><p>我们知道, 越底层的函数, 调用越频繁. 3D引擎归根到底还是数学运算. 那么找到最底层的数学运算函数 (在 <code>game/code/q_math.c</code>), 必然是精心编写的. 里面有很多有趣的函数, 很多都令人惊奇, 估计我们几年时间都学不完.</p><p>在 <code>game/code/q_math.c</code> 里发现了这样一段代码. 它的作用是将一个数开平方并取倒, 经测试这段代码比 <code>(float)(1.0/sqrt(x))</code> 快4倍:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> <span class="title function_">Q_rsqrt</span><span class="params">( <span class="type">float</span> number )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">long</span> i;</span><br><span class="line">    <span class="type">float</span> x2, y;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> threehalfs = <span class="number">1.5F</span>;</span><br><span class="line"></span><br><span class="line">    x2 = number * <span class="number">0.5F</span>;</span><br><span class="line">    y   = number;</span><br><span class="line">    i   = * ( <span class="type">long</span> * ) &amp;y;   <span class="comment">// evil floating point bit level hacking</span></span><br><span class="line">    i   = <span class="number">0x5f3759df</span> - ( i &gt;&gt; <span class="number">1</span> ); <span class="comment">// what the fuck?</span></span><br><span class="line">    y   = * ( <span class="type">float</span> * ) &amp;i;</span><br><span class="line">    y   = y * ( threehalfs - ( x2 * y * y ) ); <span class="comment">// 1st iteration</span></span><br><span class="line">    <span class="comment">// y   = y * ( threehalfs - ( x2 * y * y ) ); // 2nd iteration, this can be removed</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">ifndef</span> Q3_VM</span></span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> __linux__</span></span><br><span class="line">     assert( !isnan(y) ); <span class="comment">// bk010122 - FPE?</span></span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>函数返回 <code>1/sqrt(x)</code>, 这个函数在图像处理中比 <code>sqrt(x)</code> 更有用. 注意到这个函数只用了一次叠代! (其实就是根本没用叠代, 直接运算). 编译, 实验, 这个函数不仅工作的很好, 而且比标准的 <code>sqrt()</code> 函数快4倍! 要知道, 编译器自带的函数, 可是经过严格仔细的汇编优化的啊!</p><p>这个简洁的函数, 最核心, 也是最让人费解的, 就是标注了 <code>what the fuck?</code> 的一句<br><code>i = 0x5f3759df - ( i &gt;&gt; 1 );</code> 再加上 <code>y = y * ( threehalfs - ( x2 * y * y ) );</code> 两句话就完成了开方运算! 而且注意到, 核心那句是定点移位运算, 速度极快! 特别在很多没有乘法指令的RISC结构CPU上, 这样做是极其高效的.</p><p>算法的原理其实不复杂, 就是牛顿迭代法, 用 <code>x-f(x)/f&#39;(x)</code> 来不断的逼近 <code>f(x)=a</code>的根.</p><p>简单来说比如求平方根, <code>f(x)=x^2=a</code>, <code>f&#39;(x)= 2*x</code>, <code>f(x)/f&#39;(x)=x/2</code>, 把f(x)代入<br><code>x-f(x)/f&#39;(x)</code> 后有 <code>(x+a/x)/2</code>, 现在我们选 <code>a=5</code>, 选一个猜测值比如2, 那么我们可以这么算 <code>5/2 = 2.5; (2.5+2)/2 = 2.25; 5/2.25 = xxx; (2.25+xxx)/2 = xxxx ...</code> 这样反复迭代下去, 结果必定收敛于 <code>sqrt(5)</code>.</p><p>没错, 一般的求平方根都是这么算的. 但是卡马克(quake3作者)真正牛B的地方是他选择了一个神秘的常数 <code>0x5f3759df</code> 来计算那个猜测值. 就是我们加注释的那一行, 那一行算出的值非常接近 <code>1/sqrt(n)</code>,这样我们只需要2次牛顿迭代就可以达到我们所需要的精度.</p><p>好吧, 如果这个还不算NB, 接着看:</p><p>普渡大学的数学家Chris Lomont看了以后觉得有趣, 决定要研究一下卡马克弄出来的<br>这个猜测值有什么奥秘. Lomont也是个牛人, 在精心研究之后从理论上也推导出一个<br>最佳猜测值, 和卡马克的数字非常接近, <code>0x5f37642f</code>. 卡马克真牛, 他是外星人吗？</p><p>传奇并没有在这里结束. Lomont计算出结果以后非常满意, 于是拿自己计算出的起始<br>值和卡马克的神秘数字做比赛, 看看谁的数字能够更快更精确的求得平方根. 结果是<br>卡马克赢了… 谁也不知道卡马克是怎么找到这个数字的.</p><p>最后 Lomont怒了, 采用暴力方法一个数字一个数字试过来, 终于找到一个比卡马克数<br>字要好上那么一丁点的数字, 虽然实际上这两个数字所产生的结果非常近似, 这个暴<br>力得出的数字是 <code>0x5f375a86</code>.</p><p>Lomont为此写下一篇论文, <code>&quot;Fast Inverse Square Root&quot;</code>.</p><p>论文下载地址:</p><p><a href="http://www.math.purdue.edu/~clomont/Math/Papers/2003/InvSqrt.pdf">http://www.math.purdue.edu/~clomont/Math/Papers/2003/InvSqrt.pdf</a><br><a href="http://www.matrix67.com/data/InvSqrt.pdf">http://www.matrix67.com/data/InvSqrt.pdf</a></p><p>参考: <code>&lt;IEEE Standard 754 for Binary Floating-Point Arithmetic&gt;&lt;FAST INVERSE SQUARE ROOT&gt;</code></p><p>最后, 给出最精简的 <code>1/sqrt()</code> 函数:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> <span class="title function_">InvSqrt</span><span class="params">(<span class="type">float</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">float</span> xhalf = <span class="number">0.5f</span>*x;</span><br><span class="line">    <span class="type">int</span> i = *(<span class="type">int</span>*)&amp;x; <span class="comment">// get bits for floating VALUE</span></span><br><span class="line">    i = <span class="number">0x5f375a86</span>- (i&gt;&gt;<span class="number">1</span>); <span class="comment">// gives initial guess y0</span></span><br><span class="line">    x = *(<span class="type">float</span>*)&amp;i; <span class="comment">// convert bits BACK to float</span></span><br><span class="line">    x = x*(<span class="number">1.5f</span>-xhalf*x*x); <span class="comment">// Newton step, repeating increases accuracy</span></span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>大家可以尝试在PC机、51、AVR、430、ARM、上面编译并实验, 惊讶一下它的工作效率.</p><p>前兩天有一則新聞, 大意是說 Ryszard Sommefeldt 很久以前看到這麼樣的一段 code (可能出自 Quake III 的 source code):</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> <span class="title function_">InvSqrt</span> <span class="params">(<span class="type">float</span> x)</span> &#123;</span><br><span class="line">    <span class="type">float</span> xhalf = <span class="number">0.5f</span>*x;</span><br><span class="line">    <span class="type">int</span> i = *(<span class="type">int</span>*)&amp;x;</span><br><span class="line">    i = <span class="number">0x5f3759df</span> - (i&gt;&gt;<span class="number">1</span>);</span><br><span class="line">    x = *(<span class="type">float</span>*)&amp;i;</span><br><span class="line">    x = x*(<span class="number">1.5f</span> - xhalf*x*x);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>他一看之下驚為天人, 想要拜見這位前輩高人, 但是一路追尋下去卻一直找不到人; 同時間也有其他人在找, 雖然也沒找到出處, 但是 Chris Lomont 寫了一篇論文 (in PDF) 解析這段 code 的演算法 (用的是 Newton’s Method, 牛頓法; 比較重要的是後半段講到怎麼找出神奇的 <code>0x5f3759df</code> 的).</p><p>PS. 這個 function 之所以重要, 是因為求 <code>開根號倒數</code> 這個動作在 3D 運算 (向量運算的部份) 裡面常常會用到, 如果你用最原始的 sqrt() 然後再倒數的話, 速度比上面的這個版本大概慢了四倍吧… XD</p><p>PS2. 在他們追尋的過程中, 有人提到一份叫做 MIT HACKMEM 的文件, 這是 1970 年代的 MIT 強者們做的一些筆記 (hack memo), 大部份是 algorithm, 有些 code 是 PDP-10 asm 寫的, 另外有少數是 C code (有人整理了一份列表).</p><p>附: 牛顿迭代法快速寻找平方根</p><p>下面这种方法可以很有效地求出根号a的近似值: 首先随便猜一个近似值x, 然后不断令x等于 x 和 a&#x2F;x 的平均数, 迭代个六七次后 x 的值就已经相当精确了. 例如, 我想求根号 2 等于多少. 假如我猜测的结果为4, 虽然错的离谱, 但你可以看到使用牛顿迭代法后这个值很快就趋近于根号2了:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(       4   + 2/   4     ) / 2 = 2.25</span><br><span class="line">(     2.25   + 2/   2.25   ) / 2 = 1.56944..</span><br><span class="line">( 1.56944..+ 2/1.56944..) / 2 = 1.42189..</span><br><span class="line">( 1.42189..+ 2/1.42189..) / 2 = 1.41423..</span><br><span class="line">....</span><br></pre></td></tr></table></figure><img src="/2015/01/27/john-carmack/newton.jpg" class=""><p>这种算法的原理很简单, 我们仅仅是不断用 <code>(x, f(x))</code> 的切线来逼近方程 <code>x^2-a=0</code>的根. 根号a实际上就是 <code>x^2-a=0</code>的一个正实根, 这个函数的导数是2x. 也就是说, 函数上任一点 <code>(x,f(x))</code>处的切线斜率是2x. 那么, <code>x-f(x)/(2x)</code> 就是一个比 x 更接近的近似值. 代入 <code>f(x)=x^2-a</code> 得到 <code>x-(x^2-a)/(2x)</code>, 也就是 <code>(x+a/x)/2</code>.</p><!--more-->]]></content>
    
    
    <summary type="html">&lt;p&gt;源贴在这里 (也是转帖): &lt;a href=&quot;http://www.douban.com/note/196653073/&quot;&gt;http://www.douban.com/note/196653073/&lt;/a&gt;&lt;/p&gt;
&lt;img src=&quot;/2015/01/27/john-carmack/quake.jpg&quot; class=&quot;&quot;&gt;

&lt;p&gt;&lt;code&gt;Quake-III&lt;/code&gt; 代码里神奇的浮点开方函数&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Quake-III Arena (雷神之锤3)&lt;/code&gt; 是90年代的经典游戏之一. 该系列的游戏不但画面和内容不错, 而且即使计算机配置低, 也能极其流畅地运行. 这要归功于它3D引擎的开发者&lt;code&gt;约翰-卡马克(John Carmack)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;事实上早在90年代初DOS时代, 只要能在PC上搞个小动画都能让人惊叹一番的时候, &lt;code&gt;John Carmack&lt;/code&gt; 就推出了石破天惊的&lt;code&gt;Castle Wolfstein&lt;/code&gt;, 然后再接再励, &lt;code&gt;doom&lt;/code&gt;, &lt;code&gt;doomII&lt;/code&gt;, &lt;code&gt;Quake&lt;/code&gt;…每次都把 3-D 技术推到极致. 他的3D引擎代码极度高效, 几乎是在压榨PC机的每条运算指令. 当初MS的 &lt;code&gt;Direct3D&lt;/code&gt; 也得听取他的意见, 修改了不少API.&lt;/p&gt;</summary>
    
    
    
    <category term="prog" scheme="http://lixxu.github.io/categories/prog/"/>
    
    
  </entry>
  
  <entry>
    <title>py2exe打包psutil</title>
    <link href="http://lixxu.github.io/2015/01/16/how-to-include-components-of-psutil-in-py2exe-that-py2exe-cant-find/"/>
    <id>http://lixxu.github.io/2015/01/16/how-to-include-components-of-psutil-in-py2exe-that-py2exe-cant-find/</id>
    <published>2015-01-16T10:18:35.000Z</published>
    <updated>2023-01-07T08:37:41.942Z</updated>
    
    <content type="html"><![CDATA[<p>记录备忘.</p><p>原因:<br /></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;main.py&quot;, line 10, in &lt;module&gt;</span><br><span class="line">  File &quot;zipextimporter.pyo&quot;, line 82, in load_module</span><br><span class="line">  File &quot;utils.pyo&quot;, line 10, in &lt;module&gt;</span><br><span class="line">  File &quot;zipextimporter.pyo&quot;, line 82, in load_module</span><br><span class="line">  File &quot;psutil\__init__.pyo&quot;, line 138, in &lt;module&gt;</span><br><span class="line">  File &quot;zipextimporter.pyo&quot;, line 82, in load_module</span><br><span class="line">  File &quot;psutil\_pswindows.pyo&quot;, line 16, in &lt;module&gt;</span><br><span class="line">  File &quot;zipextimporter.pyo&quot;, line 98, in load_module</span><br><span class="line">ImportError: MemoryLoadLibrary failed loading _psutil_windows.pyd</span><br></pre></td></tr></table></figure><p>解决办法:<br /><br>1. <a href="http://stackoverflow.com/questions/20930173/how-to-include-components-of-psutil-in-py2exe-that-py2exe-cant-find">http://stackoverflow.com/questions/20930173/how-to-include-components-of-psutil-in-py2exe-that-py2exe-cant-find</a><br /><br>    <code>dll_excludes</code> 至少添加这几项: <code>&quot;IPHLPAPI.DLL&quot;, &quot;NSI.dll&quot;,  &quot;WINNSI.DLL&quot;,  &quot;WTSAPI32.dll&quot;</code></p><p>2. <a href="http://sourceforge.net/p/py2exe/bugs/130/">http://sourceforge.net/p/py2exe/bugs/130/</a><br /><br>    <code>options</code> 里的 <code>bundle_files</code> 改成 <code>3</code>, 不过打包出来的文件会有很多个.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;记录备忘.&lt;/p&gt;
&lt;p&gt;原因:&lt;br /&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span cl</summary>
      
    
    
    
    <category term="python" scheme="http://lixxu.github.io/categories/python/"/>
    
    
    <category term="py2exe" scheme="http://lixxu.github.io/tags/py2exe/"/>
    
    <category term="psutil" scheme="http://lixxu.github.io/tags/psutil/"/>
    
  </entry>
  
  <entry>
    <title>令人崩溃的 marrow.mailer 的 py2exe 打包历程</title>
    <link href="http://lixxu.github.io/2014/08/08/suck-marrow-mailer/"/>
    <id>http://lixxu.github.io/2014/08/08/suck-marrow-mailer/</id>
    <published>2014-08-08T08:10:51.000Z</published>
    <updated>2023-01-07T08:37:41.941Z</updated>
    
    <content type="html"><![CDATA[<p>今天在打包一个小工具时, 由于使用 <code>marrow.mailer</code>, 碰到了经典的 <code>py2exe 找不到使用 pip 安装的包</code> 的问题.<br>于是使用了以前的大法: <a href="http://www.py2exe.org/index.cgi/ExeWithEggs">http://www.py2exe.org/index.cgi/ExeWithEggs</a><br>再加上又碰到的各种各种的问题. 虽然最后解决了, 但是过程太崩溃了, 不想多说, 只记下过程.</p><p>1. 下载 <code>marrow.mailer</code> 压缩包, 解压, 用上面的大法安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py install_lib</span><br></pre></td></tr></table></figure><p>2. 同上, 依次安装 <code>marrow.util</code>, <code>marrow.interface</code>, <code>futures</code></p><p>3. 程序里类似这样的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> marrow.mailer.manager <span class="keyword">import</span> futures</span><br><span class="line"><span class="keyword">from</span> marrow.mailer.transport <span class="keyword">import</span> smtp</span><br><span class="line"><span class="keyword">from</span> marrow.mailer <span class="keyword">import</span> Mailer, Message</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">mailer = Mailer(&#123;<span class="string">&#x27;manager.use&#x27;</span>: futures.FuturesManager,</span><br><span class="line">                 <span class="string">&#x27;transport.use&#x27;</span>: smtp.SMTPTransport,</span><br><span class="line">                 <span class="string">&#x27;transport.host&#x27;</span>: host,</span><br><span class="line">                 &#125;)</span><br><span class="line">mailer.start()</span><br><span class="line">author = ((<span class="string">&#x27;Sender&#x27;</span>, <span class="string">&#x27;no-reply@example.com&#x27;</span>))</span><br><span class="line">msg = Message(author=author)</span><br><span class="line">msg.subject = <span class="string">&#x27;Subject&#x27;</span></span><br><span class="line">msg.to = [<span class="string">&#x27;aaa@example.com&#x27;</span>]</span><br><span class="line">msg.plain = <span class="string">&#x27;plain mail&#x27;</span></span><br><span class="line">msg.rich = <span class="string">&#x27;rich html&#x27;</span></span><br><span class="line"></span><br><span class="line">mailer.send(msg)</span><br><span class="line">mailer.stop()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>备注:</p><p>由于 <code>marrow.mailer</code> 的 bug: <a href="https://github.com/marrow/marrow.mailer/issues/36">https://github.com/marrow/marrow.mailer/issues/36</a> , 导致 <code>manager.use</code>, <code>transport.use</code> 要写成上面的格式, 看了源码才发现.当然这种写法在不需要打包时是不需要的:</p><figure class="highlight python"><figcaption><span>site-packages\marrow\mailer\__init__.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(Manager, IManager):</span><br><span class="line">    <span class="keyword">raise</span> TypeError(<span class="string">&quot;Chosen manager does not conform to the manager API.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(Transport, ITransport):</span><br><span class="line">    <span class="keyword">raise</span> TypeError(<span class="string">&quot;Chosen transport does not conform to the transport API.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;今天在打包一个小工具时, 由于使用 &lt;code&gt;marrow.mailer&lt;/code&gt;, 碰到了经典的 &lt;code&gt;py2exe 找不到使用 pip 安装的包&lt;/code&gt; 的问题.&lt;br&gt;于是使用了以前的大法: &lt;a href=&quot;http://www.py2exe.or</summary>
      
    
    
    
    <category term="python" scheme="http://lixxu.github.io/categories/python/"/>
    
    
    <category term="python" scheme="http://lixxu.github.io/tags/python/"/>
    
    <category term="py2exe" scheme="http://lixxu.github.io/tags/py2exe/"/>
    
    <category term="marrowmailer" scheme="http://lixxu.github.io/tags/marrowmailer/"/>
    
  </entry>
  
  <entry>
    <title>作为一个东北人, 被人无数次问过</title>
    <link href="http://lixxu.github.io/2014/08/07/as-a-man/"/>
    <id>http://lixxu.github.io/2014/08/07/as-a-man/</id>
    <published>2014-08-07T10:39:52.000Z</published>
    <updated>2023-01-07T08:37:41.939Z</updated>
    
    <content type="html"><![CDATA[<p>网上看到, 忍不住放到这里收藏下:</p><img src="/2014/08/07/as-a-man/dongbeiren.jpg" class="">]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;网上看到, 忍不住放到这里收藏下:&lt;/p&gt;
&lt;img src=&quot;/2014/08/07/as-a-man/dongbeiren.jpg&quot; class=&quot;&quot;&gt;
</summary>
      
    
    
    
    <category term="joke" scheme="http://lixxu.github.io/categories/joke/"/>
    
    
    <category term="joke" scheme="http://lixxu.github.io/tags/joke/"/>
    
  </entry>
  
  <entry>
    <title>Windows下git保存密码</title>
    <link href="http://lixxu.github.io/2014/07/29/git-windows-credential/"/>
    <id>http://lixxu.github.io/2014/07/29/git-windows-credential/</id>
    <published>2014-07-29T12:27:58.000Z</published>
    <updated>2023-01-07T08:37:41.938Z</updated>
    
    <content type="html"><![CDATA[<p>更新: 直接保存密码是不行的, 需要安装 <code>git-credential-winstore</code>.<br>安装后, 就可以手动添加密码了.</p><p>越来越觉得 <code>SourceTree</code> 启动慢, 我都尽量在命令行下使用 <code>git</code> 了 (这样才是正道吧).<br>每次的推送都要输入用户名和密码, 用了 <code>_netrc</code> 大法也不管用, 隐约记得之前可以的, 是人品越来越好了吗?</p><p>总感觉不甘心, 就翻看 <a href="http://stackoverflow.com/questions/6031214/git-how-to-use-netrc-file-on-windows-to-save-user-and-password">http://stackoverflow.com/questions/6031214/git-how-to-use-netrc-file-on-windows-to-save-user-and-password</a>, 看到 <code>git-credential-winstore</code> 这里, 就进去看看, 下载安装, 很小巧的东西, 才十几K.</p><p>接着再推送时, 弹出对话框, 输入用户名和密码, 就可以了. 看这个窗口的架势, 是在系统的密码管理里面, 进去一看, 果不其然, 在通用安全里, 静静地躺着刚刚保存的密码.<br>没有安装 <code>git-credential-winstore</code> (<a href="https://gitcredentialstore.codeplex.com/">https://gitcredentialstore.codeplex.com/</a>) 的同学可以手动添加试试, 此法仅限于 <code>http</code> 方式的验证, 不适合 <code>ssh</code> 模式.</p><img src="/2014/07/29/git-windows-credential/windows_git_save_password.png" class=""><p>顺便换上了 <code>度娘</code> 的CDN, 还用上了雅黑字体:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;http://libs.baidu.com/jquery/1.9.1/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>还有 <code>渣浪</code> 和 <code>小斗士</code> 的:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;http://lib.sinaapp.com/js/jquery/1.9.1/jquery-1.9.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=&quot;http://libs.useso.com/js/jquery/1.9.1/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;更新: 直接保存密码是不行的, 需要安装 &lt;code&gt;git-credential-winstore&lt;/code&gt;.&lt;br&gt;安装后, 就可以手动添加密码了.&lt;/p&gt;
&lt;p&gt;越来越觉得 &lt;code&gt;SourceTree&lt;/code&gt; 启动慢, 我都尽量在命令行下使用 &lt;cod</summary>
      
    
    
    
    <category term="git" scheme="http://lixxu.github.io/categories/git/"/>
    
    
    <category term="git" scheme="http://lixxu.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>抓取 &lt;&lt;码农故事&gt;&gt; 文本</title>
    <link href="http://lixxu.github.io/2014/07/25/get-coder-story-text-from-web/"/>
    <id>http://lixxu.github.io/2014/07/25/get-coder-story-text-from-web/</id>
    <published>2014-07-25T00:46:39.000Z</published>
    <updated>2023-01-07T08:37:41.916Z</updated>
    
    <content type="html"><![CDATA[<p>偶然看到这样一篇关于码农的小说, 感觉还可以, 就想收集下来慢慢看.<br>但是都是网页而且还挺多, 就看看有没有整理好的全本, 搜了一下没找到.</p><p>接着就手动复制粘贴, 贴了几篇感觉太枯燥, 就琢磨着如何使用 <code>requests</code> 和 <code>BeautifulSoup</code> 来提取文本.</p><p>很少使用 <code>BeautifulSoup</code>, 所以临时去看了一下文档, 开始走起.</p><span id="more"></span><ol><li><p>先用浏览器的 <code>审查元素</code> 获取分页的页面结构, 这里我们只需要 <code>标题</code> 和 <code>链接地址</code> 即可</p> </li><li><p>分析页面内容抓取 <code>标题</code> 和 <code>链接地址</code>, 还一并抓取当前的章节, 否则就没法知道顺序了</p></li><li><p>根据获取的链接抓取全文</p></li><li><p>分析全文, 在 <code>entry</code> 下面的 <code>p</code> 和 <code>span</code> 里, 一开始我以为都在 <code>p</code> 结构里, 结果最后发现有的章节是空的, 看了下空的章节的结构, 原来用的是 <code>&lt;div&gt;&lt;span&gt;...&lt;/span&gt;&lt;/div&gt;</code> 的结构</p> <img src="/2014/07/25/get-coder-story-text-from-web/coder_post.png" class=""> <img src="/2014/07/25/get-coder-story-text-from-web/coder_post2.png" class=""></li><li><p>这些都确定了后就可以开工了, 当然我是逐步确定的. 我的流程是: 按章节写到单独的文件里, 最后再合并. 好了, <code>Talk is cheap, show me the code.</code>:</p> <figure class="highlight python"><figcaption><span>coder_story.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">digit_re = re.<span class="built_in">compile</span>(<span class="string">&#x27;(\d+-?\d*)&#x27;</span>)</span><br><span class="line">url = <span class="string">r&#x27;http://blog.jobbole.com/tag/%E7%A0%81%E5%86%9C%E6%95%85%E4%BA%8B/page/&#123;&#125;/&#x27;</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;coder_story&#x27;</span>):</span><br><span class="line">    os.makedirs(<span class="string">&#x27;coder_story&#x27;</span>)</span><br><span class="line"></span><br><span class="line">os.chdir(<span class="string">&#x27;coder_story&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> page <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>):</span><br><span class="line">    r = requests.get(url.<span class="built_in">format</span>(page))</span><br><span class="line">    <span class="comment"># soup = BeautifulSoup(r.content)  # lxml未安装时用这行</span></span><br><span class="line">    soup = BeautifulSoup(r.content, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> meta_title <span class="keyword">in</span> soup.find_all(<span class="string">&#x27;a&#x27;</span>, class_=<span class="string">&#x27;meta-title&#x27;</span>):</span><br><span class="line">        <span class="comment"># 我们要的都必须有title</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;title&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> meta_title.attrs:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 不是这个小说不要</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">u&#x27;老码农原创小说&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> meta_title[<span class="string">&#x27;title&#x27;</span>]:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(meta_title)  <span class="comment"># 打印一下标题</span></span><br><span class="line">        href = meta_title.get(<span class="string">&#x27;href&#x27;</span>)  <span class="comment"># 获取文章链接</span></span><br><span class="line">        <span class="comment"># 获取章节序号</span></span><br><span class="line">        found = digit_re.findall(meta_title[<span class="string">&#x27;title&#x27;</span>])</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> found:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 个位数章节前补0, 为了后面的合并</span></span><br><span class="line">        page_no = found[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(page_no.split(<span class="string">&#x27;-&#x27;</span>)[<span class="number">0</span>]) &lt; <span class="number">10</span>:</span><br><span class="line">            page_no = <span class="string">&#x27;0&#x27;</span> + page_no</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取文章的内容</span></span><br><span class="line">        r2 = requests.get(href)</span><br><span class="line">        <span class="comment"># s2 = BeautifulSoup(r2.content)  # lxml未安装时用这行</span></span><br><span class="line">        s2 = BeautifulSoup(r2.content, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">        entry = s2.find(<span class="string">&#x27;div&#x27;</span>, class_=<span class="string">&#x27;entry&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;&#123;&#125;.txt&#x27;</span>.<span class="built_in">format</span>(page_no), <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="comment"># 内容在 &lt;p&gt;...&lt;/p&gt; 或 &lt;div&gt;&lt;span&gt;...&lt;/span&gt;&lt;/div&gt;里</span></span><br><span class="line">            <span class="keyword">for</span> p <span class="keyword">in</span> entry.find_all([<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;span&#x27;</span>]):</span><br><span class="line">                <span class="comment"># copyright-meta部分, 跳过</span></span><br><span class="line">                <span class="keyword">if</span> p.get(<span class="string">&#x27;class&#x27;</span>):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 空白行, 文件里写两行空白, 便于阅读</span></span><br><span class="line">                text = p.get_text()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> text:</span><br><span class="line">                    f.write(<span class="string">&#x27;\r\n\r\n&#x27;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                f.write(text.encode(<span class="string">&#x27;utf-8&#x27;</span>) + <span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">                <span class="comment"># &quot;待续&quot; 的地方, 接着就是另一章了, 插入空行</span></span><br><span class="line">                <span class="keyword">if</span> text.endswith(<span class="string">u&#x27;&lt;\u5f85\u7eed&gt;&#x27;</span>):</span><br><span class="line">                    f.write(<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>合并到一个文件, 用 <code>Python</code> 碰到编码错误, 时间紧, 就用批处理好了, 还简单</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy *.txt 码农故事.txt</span><br></pre></td></tr></table></figure></li><li><p>打完收工.</p></li></ol><p>后记:</p><p>就在合并时, 看到最后的一句话, 马上吐出一升老血:</p><img src="/2014/07/25/get-coder-story-text-from-web/coder_end.png" class=""><img src="/2014/07/25/get-coder-story-text-from-web/tuxie.gif" class=""><p>不过, 在 <code>kindle</code> 上还是 txt 的效果好一些, pdf 转换的有些乱码, 不完美.</p><img src="/2014/07/25/get-coder-story-text-from-web/kindle_bug.png" class=""><p>附下载地址:</p><ol><li><a href="/2014/07/25/get-coder-story-text-from-web/%E7%A0%81%E5%86%9C%E6%95%85%E4%BA%8B.txt" title="码农故事.txt">码农故事.txt</a></li><li><a href="/2014/07/25/get-coder-story-text-from-web/%E7%A0%81%E5%86%9C%E6%95%85%E4%BA%8B.pdf" title="码农故事.pdf">码农故事.pdf</a></li></ol><!--more-->]]></content>
    
    
    <summary type="html">&lt;p&gt;偶然看到这样一篇关于码农的小说, 感觉还可以, 就想收集下来慢慢看.&lt;br&gt;但是都是网页而且还挺多, 就看看有没有整理好的全本, 搜了一下没找到.&lt;/p&gt;
&lt;p&gt;接着就手动复制粘贴, 贴了几篇感觉太枯燥, 就琢磨着如何使用 &lt;code&gt;requests&lt;/code&gt; 和 &lt;code&gt;BeautifulSoup&lt;/code&gt; 来提取文本.&lt;/p&gt;
&lt;p&gt;很少使用 &lt;code&gt;BeautifulSoup&lt;/code&gt;, 所以临时去看了一下文档, 开始走起.&lt;/p&gt;</summary>
    
    
    
    <category term="python" scheme="http://lixxu.github.io/categories/python/"/>
    
    
    <category term="python" scheme="http://lixxu.github.io/tags/python/"/>
    
    <category term="requests" scheme="http://lixxu.github.io/tags/requests/"/>
    
    <category term="bs4" scheme="http://lixxu.github.io/tags/bs4/"/>
    
    <category term="beautifulsoup" scheme="http://lixxu.github.io/tags/beautifulsoup/"/>
    
  </entry>
  
  <entry>
    <title>使用 Python 设置系统时间</title>
    <link href="http://lixxu.github.io/2014/06/22/use-python-set-system-time/"/>
    <id>http://lixxu.github.io/2014/06/22/use-python-set-system-time/</id>
    <published>2014-06-22T08:53:43.000Z</published>
    <updated>2023-01-07T08:37:41.916Z</updated>
    
    <content type="html"><![CDATA[<p>接上文: <a href="/blog/2014/06/22/nssm-install-windows-service">使用 NSSM 安装 Windows 系统服务</a></p><p>上一篇介绍使用了 <code>net time</code> 来同步系统时间, 后来突然想到如果没有服务器可供同步时间或电脑无法直接连接到服务器怎么办?</p><p>就去找了下使用 <code>Python</code> 设置时间的例子, 还真有: <a href="http://stackoverflow.com/questions/12081310/python-module-to-change-system-date-and-time">http://stackoverflow.com/questions/12081310/python-module-to-change-system-date-and-time</a></p><span id="more"></span><p>直接贴在这里:</p><figure class="highlight python"><figcaption><span>set_time.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">time_tuple = (<span class="number">2012</span>, <span class="comment"># Year</span></span><br><span class="line">                 <span class="number">9</span>, <span class="comment"># Month</span></span><br><span class="line">                 <span class="number">6</span>, <span class="comment"># Day</span></span><br><span class="line">                 <span class="number">0</span>, <span class="comment"># Hour</span></span><br><span class="line">                <span class="number">38</span>, <span class="comment"># Minute</span></span><br><span class="line">                 <span class="number">0</span>, <span class="comment"># Second</span></span><br><span class="line">                 <span class="number">0</span>, <span class="comment"># Millisecond</span></span><br><span class="line">              )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_win_set_time</span>(<span class="params">time_tuple</span>):</span><br><span class="line">    <span class="keyword">import</span> pywin32</span><br><span class="line">    <span class="comment"># http://timgolden.me.uk/pywin32-docs/win32api__SetSystemTime_meth.html</span></span><br><span class="line">    <span class="comment"># pywin32.SetSystemTime(year, month, dayOfWeek, day, hour, minute, second, millseconds)</span></span><br><span class="line">    dayOfWeek = datetime.datetime(time_tuple).isocalendar()[<span class="number">2</span>]</span><br><span class="line">    pywin32.SetSystemTime(time_tuple[:<span class="number">2</span>] + (dayOfWeek,) + time_tuple[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_linux_set_time</span>(<span class="params">time_tuple</span>):</span><br><span class="line">    <span class="keyword">import</span> ctypes</span><br><span class="line">    <span class="keyword">import</span> ctypes.util</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">    <span class="comment"># /usr/include/linux/time.h:</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># define CLOCK_REALTIME                     0</span></span><br><span class="line">    CLOCK_REALTIME = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># /usr/include/time.h</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># struct timespec</span></span><br><span class="line">    <span class="comment">#  &#123;</span></span><br><span class="line">    <span class="comment">#    __time_t tv_sec;            /* Seconds.  */</span></span><br><span class="line">    <span class="comment">#    long int tv_nsec;           /* Nanoseconds.  */</span></span><br><span class="line">    <span class="comment">#  &#125;;</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">timespec</span>(ctypes.Structure):</span><br><span class="line">        _fields_ = [(<span class="string">&quot;tv_sec&quot;</span>, ctypes.c_long),</span><br><span class="line">                    (<span class="string">&quot;tv_nsec&quot;</span>, ctypes.c_long)]</span><br><span class="line"></span><br><span class="line">    librt = ctypes.CDLL(ctypes.util.find_library(<span class="string">&quot;rt&quot;</span>))</span><br><span class="line"></span><br><span class="line">    ts = timespec()</span><br><span class="line">    ts.tv_sec = <span class="built_in">int</span>(time.mktime(datetime.datetime(*time_tuple[:<span class="number">6</span>]).timetuple()))</span><br><span class="line">    ts.tv_nsec = time_tuple[<span class="number">6</span>] * <span class="number">1000000</span> <span class="comment"># Millisecond to nanosecond</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># http://linux.die.net/man/3/clock_settime</span></span><br><span class="line">    librt.clock_settime(CLOCK_REALTIME, ctypes.byref(ts))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sys.platform==<span class="string">&#x27;linux2&#x27;</span>:</span><br><span class="line">    _linux_set_time(time_tuple)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span>  sys.platform==<span class="string">&#x27;win32&#x27;</span>:</span><br><span class="line">    _win_set_time(time_tuple)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可是没有可供同步用的服务器, 那时间怎么来呢?</p><ol><li><p>跑一个 web, 可以返回一个 <code>json</code> 的数据, 如:</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/get-time/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_time</span>():</span><br><span class="line">    <span class="keyword">return</span> jsonify(time=<span class="built_in">tuple</span>(datetime.utcnow().timetuple()))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> 客户端可以这样来获取和同步时间 (假设是 Windows 平台), 上面的 <code>set_time.py</code> 需要改一下:</p> <figure class="highlight python"><figcaption><span>set_time2.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_win_set_time</span>(<span class="params">time_tuple</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;time_tuple:</span></span><br><span class="line"><span class="string">    year, month, day, hour, minute, second, day_of_week, day_of_year, is_dist</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> pywin32</span><br><span class="line">    <span class="comment"># http://timgolden.me.uk/pywin32-docs/win32api__SetSystemTime_meth.html</span></span><br><span class="line">    <span class="comment"># pywin32.SetSystemTime(year, month, dayOfWeek, day, hour, minute, second, millseconds)</span></span><br><span class="line">    tt = <span class="built_in">list</span>(time_tuple)</span><br><span class="line">    tt.insert(<span class="number">2</span>, tt[<span class="number">6</span>]) <span class="comment"># add day_of_week</span></span><br><span class="line">    tt.insert(<span class="number">7</span>, <span class="number">0</span>)  <span class="comment"># set miliseconds</span></span><br><span class="line">    pywin32.SetSystemTime(*tt[:<span class="number">8</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_linux_set_time</span>(<span class="params">time_tuple</span>):</span><br><span class="line">    <span class="keyword">import</span> ctypes</span><br><span class="line">    <span class="keyword">import</span> ctypes.util</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">    <span class="comment"># /usr/include/linux/time.h:</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># define CLOCK_REALTIME                     0</span></span><br><span class="line">    CLOCK_REALTIME = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># /usr/include/time.h</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># struct timespec</span></span><br><span class="line">    <span class="comment">#  &#123;</span></span><br><span class="line">    <span class="comment">#    __time_t tv_sec;            /* Seconds.  */</span></span><br><span class="line">    <span class="comment">#    long int tv_nsec;           /* Nanoseconds.  */</span></span><br><span class="line">    <span class="comment">#  &#125;;</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">timespec</span>(ctypes.Structure):</span><br><span class="line">        _fields_ = [(<span class="string">&quot;tv_sec&quot;</span>, ctypes.c_long),</span><br><span class="line">                    (<span class="string">&quot;tv_nsec&quot;</span>, ctypes.c_long)]</span><br><span class="line"></span><br><span class="line">    librt = ctypes.CDLL(ctypes.util.find_library(<span class="string">&quot;rt&quot;</span>))</span><br><span class="line"></span><br><span class="line">    ts = timespec()</span><br><span class="line">    ts.tv_sec = <span class="built_in">int</span>(time.mktime(datetime.datetime(*time_tuple[:<span class="number">6</span>]).timetuple()))</span><br><span class="line">    ts.tv_nsec = time_tuple[<span class="number">6</span>] * <span class="number">1000000</span> <span class="comment"># Millisecond to nanosecond</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># http://linux.die.net/man/3/clock_settime</span></span><br><span class="line">    librt.clock_settime(CLOCK_REALTIME, ctypes.byref(ts))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_time</span>(<span class="params">time_tuple</span>):</span><br><span class="line">    <span class="keyword">if</span> sys.platform==<span class="string">&#x27;linux2&#x27;</span>:</span><br><span class="line">        _linux_set_time(time_tuple)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span>  sys.platform==<span class="string">&#x27;win32&#x27;</span>:</span><br><span class="line">        _win_set_time(time_tuple)</span><br><span class="line"></span><br></pre></td></tr></table></figure> <figure class="highlight python"><figcaption><span>sync_time.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> set_time2</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&#x27;http://a.b.c.d:5000/api/get-time/&#x27;</span></span><br><span class="line">offset = time.timezone <span class="keyword">if</span> (time.localtime().tm_isdst == <span class="number">0</span>) <span class="keyword">else</span> time.altzone</span><br><span class="line">LOCAL_TZ = offset / <span class="number">60</span> / <span class="number">60</span> * -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_time</span>():</span><br><span class="line">    r = requests.get(URL)</span><br><span class="line">    json = r.json()</span><br><span class="line">    <span class="keyword">return</span> json[<span class="string">&#x27;time&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sync_time</span>(<span class="params">tz, ts</span>):</span><br><span class="line">    ts = get_time()</span><br><span class="line">    to_time = datetime(*ts[:<span class="number">6</span>]) + timedelta(hours=LOCAL_TZ)</span><br><span class="line">    set_time2.set_time(to_time.timetuple())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    sync_time()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> 注意: 以上代码未经测试, 可能有错误.</p></li><li><p>如果无法直接连接到提供时间的服务器呢?<br> 比如有两个网络, 一个是测试电脑的内部网, 服务器在测试的通用网络.</p><p> 可以使用一个可以连通两个网络的电脑上作为交换数据的中间人, 具体的是使用文件交换还是像 <code>socket</code> 之类的网络接口服务交换就随你的喜好了.</p></li></ol><p>拙见.</p><!--more-->]]></content>
    
    
    <summary type="html">&lt;p&gt;接上文: &lt;a href=&quot;/blog/2014/06/22/nssm-install-windows-service&quot;&gt;使用 NSSM 安装 Windows 系统服务&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上一篇介绍使用了 &lt;code&gt;net time&lt;/code&gt; 来同步系统时间, 后来突然想到如果没有服务器可供同步时间或电脑无法直接连接到服务器怎么办?&lt;/p&gt;
&lt;p&gt;就去找了下使用 &lt;code&gt;Python&lt;/code&gt; 设置时间的例子, 还真有: &lt;a href=&quot;http://stackoverflow.com/questions/12081310/python-module-to-change-system-date-and-time&quot;&gt;http://stackoverflow.com/questions/12081310/python-module-to-change-system-date-and-time&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="python" scheme="http://lixxu.github.io/categories/python/"/>
    
    
    <category term="python" scheme="http://lixxu.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>使用 NSSM 安装 Windows 系统服务</title>
    <link href="http://lixxu.github.io/2014/06/22/nssm-install-windows-service/"/>
    <id>http://lixxu.github.io/2014/06/22/nssm-install-windows-service/</id>
    <published>2014-06-22T08:15:55.000Z</published>
    <updated>2023-01-07T08:37:41.916Z</updated>
    
    <content type="html"><![CDATA[<p>工厂里的某些测试电脑存在时间不对的问题, 最开始使用简单的批处理加上<br><a href="http://nssm.cc/">nssm</a> 安装成 service 的方式, 比如下面的示例:</p><figure class="highlight plaintext"><figcaption><span>sync_time.bat</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sync_time:</span><br><span class="line">net time \\a.b.c.d /set /y</span><br><span class="line"></span><br><span class="line">sleep 3600</span><br><span class="line">goto sync_time</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>但在使用的过程中出现了这个 service 吃掉许多 CPU 的问题.<br>按道理说在 sleep 后应该会进入休眠状态, 不应该再占用 CPU.<br>不清楚什么原因, 就使用 <code>Python</code> 重写了.</p><span id="more"></span><p>1. 主程序 <code>main.py</code></p><figure class="highlight python"><figcaption><span>main.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line">__version__ = <span class="string">&#x27;0.1&#x27;</span></span><br><span class="line">DEFAULT_SERVERS = <span class="string">&#x27;server_a,server_b&#x27;</span></span><br><span class="line">IP_MAPS = <span class="built_in">dict</span>(server_a=<span class="string">&#x27;a.b.c.d&#x27;</span>, server_b=<span class="string">&#x27;a.b.c.e&#x27;</span>)</span><br><span class="line">CMD = <span class="string">r&#x27;net time \\&#123;&#125; /set /y&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_cmd</span>(<span class="params">server</span>):</span><br><span class="line">    status = subprocess.call(CMD.<span class="built_in">format</span>(server))</span><br><span class="line">    <span class="keyword">if</span> status == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    ip = IP_MAPS.get(server)</span><br><span class="line">    <span class="keyword">if</span> ip:</span><br><span class="line">        <span class="keyword">return</span> subprocess.call(CMD.<span class="built_in">format</span>(ip), shell=<span class="literal">True</span>) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;--servers&#x27;</span>, default=DEFAULT_SERVERS,</span></span></span><br><span class="line"><span class="params"><span class="meta">              <span class="built_in">help</span>=<span class="string">&#x27;servers name or IP list, seperated by &quot;,&quot;&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;--sleep&#x27;</span>, default=<span class="number">600</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">              <span class="built_in">help</span>=<span class="string">&#x27;sleep seconds till next run, default is 600s (10 minutes)&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sync_time</span>(<span class="params">servers, sleep</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> server <span class="keyword">in</span> servers.split(<span class="string">&#x27;,&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> run_cmd(server.strip()):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        time.sleep(sleep)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    sync_time()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2. 使用 <code>py2exe</code> 或其他工具打包 <code>main.py</code> 为可执行文件, 比如 <code>SyncTimer.exe</code></p><p>3. 然后是安装&#x2F;删除 service 的批处理:</p><p>3.1 <code>install.bat</code></p><figure class="highlight plaintext"><figcaption><span>install.bat</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">set service=SyncTimer</span><br><span class="line">echo %PROCESSOR_ARCHITECTURE% | find /i &quot;x86&quot; &gt; nul</span><br><span class="line">if %errorlevel%==0 (</span><br><span class="line">    set nssm=nssm32.exe</span><br><span class="line">) else (</span><br><span class="line">    set nssm=nssm64.exe</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">%nssm% install &quot;%service%&quot; &quot;%~dp0SyncTimer.exe&quot;</span><br><span class="line"></span><br><span class="line">net start %service%</span><br><span class="line"></span><br><span class="line">sleep 5</span><br></pre></td></tr></table></figure><p>3.2 <code>remove.bat</code></p><figure class="highlight plaintext"><figcaption><span>remove.bat</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">set exename=SyncTimer</span><br><span class="line">net stop %exename%</span><br><span class="line"></span><br><span class="line">echo %PROCESSOR_ARCHITECTURE% | find /i &quot;x86&quot; &gt; nul</span><br><span class="line">if %errorlevel%==0 (</span><br><span class="line">    set nssm=nssm32.exe</span><br><span class="line">) else (</span><br><span class="line">    set nssm=nssm64.exe</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">%nssm% remove &quot;%exename%&quot; confirm</span><br><span class="line">sleep 5</span><br></pre></td></tr></table></figure><p>当然了, 你需要到 <a href="http://nssm.cc/download">http://nssm.cc/download</a> 下载 <code>nssm</code> 的执行程序.<br>分别把 32 位和 64 位的执行文件和你的 EXE 文件放到一起, 并改名为 <code>nssm32.exe</code> 和 <code>nssm64.exe</code>. 在安装 service 后也不能删除这些文件, 因为 service 关联的程序是 <code>nssm</code>.</p><p>这里有个注意的地方:<br><code>nssm</code> 的文档上说使用命令行安装时如果不想弹出确认对话框, 可以写成这样的:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%nssm% install &quot;%service%&quot; &quot;%~dp0SyncTimer.exe&quot; confirm</span><br></pre></td></tr></table></figure><p>但是这样安装的 service 始终处于 <code>paused</code> 状态, 一度让我以为是程序里 <code>sleep</code> 导致的. 但在使用对话框安装时却一点问题都没有.<br>后来看了下系统日志, 发现是路径的问题. 后面就使用 exe 的绝对路径并且把后面的 <code>confirm</code> 给去掉了才算正常.</p><p>本来打算写如何使用 <code>Python</code> 设置系统时间的怎么变成 <code>nssm</code> 了?</p><!--more-->]]></content>
    
    
    <summary type="html">&lt;p&gt;工厂里的某些测试电脑存在时间不对的问题, 最开始使用简单的批处理加上&lt;br&gt;&lt;a href=&quot;http://nssm.cc/&quot;&gt;nssm&lt;/a&gt; 安装成 service 的方式, 比如下面的示例:&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;figcaption&gt;&lt;span&gt;sync_time.bat&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sync_time:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net time \\a.b.c.d /set /y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sleep 3600&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;goto sync_time&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;但在使用的过程中出现了这个 service 吃掉许多 CPU 的问题.&lt;br&gt;按道理说在 sleep 后应该会进入休眠状态, 不应该再占用 CPU.&lt;br&gt;不清楚什么原因, 就使用 &lt;code&gt;Python&lt;/code&gt; 重写了.&lt;/p&gt;</summary>
    
    
    
    <category term="prog" scheme="http://lixxu.github.io/categories/prog/"/>
    
    
    <category term="nssm" scheme="http://lixxu.github.io/tags/nssm/"/>
    
  </entry>
  
  <entry>
    <title>Flask-script 和 gevent 结合使用</title>
    <link href="http://lixxu.github.io/2014/06/10/use-gevent-with-flask-script/"/>
    <id>http://lixxu.github.io/2014/06/10/use-gevent-with-flask-script/</id>
    <published>2014-06-10T07:09:51.000Z</published>
    <updated>2023-01-07T08:37:41.915Z</updated>
    
    <content type="html"><![CDATA[<p>之前一直没用过 <code>flask-script</code>, 可是看了很多其他人的例子都在用这么个玩意. 碰巧手上有个现在做的一个应用, 所以打算用一下.</p><p>用了之后出现问题了: <code>python manage.py runserver</code> 使用的是默认的 <code>wsgi 服务器</code>, 而我在 windows 下一直使用 <code>gevent</code> 调试的.<br>看了下文档, 差不多就是这样:</p><figure class="highlight python"><figcaption><span>manage.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app, db</span><br><span class="line"><span class="keyword">from</span> app.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> flask.ext.script <span class="keyword">import</span> Manager, Shell</span><br><span class="line"><span class="keyword">from</span> flask.ext.migrate <span class="keyword">import</span> Migrate, MigrateCommand</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.isfile(<span class="string">&#x27;app.env&#x27;</span>):</span><br><span class="line">    <span class="comment"># print(&#x27;importing environment from app.env...&#x27;)</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;app.env&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> line.lstrip().startswith(<span class="string">&#x27;#&#x27;</span>) <span class="keyword">and</span> <span class="string">&#x27;=&#x27;</span> <span class="keyword">in</span> line:</span><br><span class="line">                items = line.strip().split(<span class="string">&#x27;=&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">                os.environ[<span class="built_in">str</span>(items[<span class="number">0</span>].strip())] = <span class="built_in">str</span>(items[<span class="number">1</span>].strip())</span><br><span class="line"></span><br><span class="line">app = create_app(os.getenv(<span class="string">&#x27;APP_ENV&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;default&#x27;</span>)</span><br><span class="line">manager = Manager(app)</span><br><span class="line">migrate = Migrate(app, db)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_shell_context</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(app=app, db=db, User=User)</span><br><span class="line"></span><br><span class="line">manager.add_command(<span class="string">&#x27;shell&#x27;</span>, Shell(make_context=make_shell_context))</span><br><span class="line">manager.add_command(<span class="string">&#x27;db&#x27;</span>, MigrateCommand)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@manager.command</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deploy</span>():</span><br><span class="line">    <span class="keyword">from</span> flask.ext.migrate <span class="keyword">import</span> upgrade</span><br><span class="line"></span><br><span class="line">    upgrade()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line marked"><span class="meta">@manager.command</span></span><br><span class="line marked"><span class="keyword">def</span> <span class="title function_">rungevent</span>():</span><br><span class="line marked">    <span class="keyword">import</span> werkzeug.serving</span><br><span class="line marked">    <span class="keyword">from</span> werkzeug.debug <span class="keyword">import</span> DebuggedApplication</span><br><span class="line marked">    <span class="keyword">from</span> gevent.wsgi <span class="keyword">import</span> WSGIServer</span><br><span class="line marked"></span><br><span class="line marked"><span class="meta">    @werkzeug.serving.run_with_reloader</span></span><br><span class="line marked">    <span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line marked">        app.debug = <span class="literal">True</span></span><br><span class="line marked">        dapp = DebuggedApplication(app, evalex=<span class="literal">True</span>)</span><br><span class="line marked">        ws = WSGIServer((<span class="string">&#x27;&#x27;</span>, <span class="number">5000</span>), dapp)</span><br><span class="line marked">        ws.serve_forever()</span><br><span class="line marked"></span><br><span class="line marked">    run()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    manager.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后使用下面的命令就可以了:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py rungevent</span><br></pre></td></tr></table></figure><p>可是在 <code>rungevent</code> 里, 无论怎么传参数控制是否处在 <code>debug</code> 状态, 始终是 <code>autoreload</code>, 这可能是 <code>app.env</code> 里我设定了开发模式导致的.</p><p>不过, 算了, 生产环境我是用 <code>uwsgi</code> 的, 用不到这个玩意.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;之前一直没用过 &lt;code&gt;flask-script&lt;/code&gt;, 可是看了很多其他人的例子都在用这么个玩意. 碰巧手上有个现在做的一个应用, 所以打算用一下.&lt;/p&gt;
&lt;p&gt;用了之后出现问题了: &lt;code&gt;python manage.py runserver&lt;/cod</summary>
      
    
    
    
    <category term="python" scheme="http://lixxu.github.io/categories/python/"/>
    
    
    <category term="python" scheme="http://lixxu.github.io/tags/python/"/>
    
    <category term="gevent" scheme="http://lixxu.github.io/tags/gevent/"/>
    
    <category term="flask-script" scheme="http://lixxu.github.io/tags/flask-script/"/>
    
  </entry>
  
  <entry>
    <title>在 PyPi 上发布软件包</title>
    <link href="http://lixxu.github.io/2014/06/09/how-to-register-pypi/"/>
    <id>http://lixxu.github.io/2014/06/09/how-to-register-pypi/</id>
    <published>2014-06-09T06:33:10.000Z</published>
    <updated>2023-01-07T08:37:41.914Z</updated>
    
    <content type="html"><![CDATA[<p>更新:<br>现在都用 <a href="https://pypi.org/project/twine/">https://pypi.org/project/twine/</a> 了.</p><p>距上次发布软件包过去了很久, 都忘了操作步骤了, 今天碰巧发布一个小包, 放狗搜了一下, 记下来备忘:</p><p>来源: <a href="http://peterdowns.com/posts/first-time-with-pypi.html">http://peterdowns.com/posts/first-time-with-pypi.html</a></p><p>基本操作:</p><p>1. 准备好 <code>setup.py</code>, 提供一下 <code>setup.cfg</code></p><figure class="highlight ini"><figcaption><span>setup.cfg</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[metadata]</span></span><br><span class="line"><span class="attr">description-file</span> = README.md</span><br></pre></td></tr></table></figure><p>2. 注册:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py register -r pypi</span><br></pre></td></tr></table></figure><p>按提示做选择就可以了:</p><img src="/2014/06/09/how-to-register-pypi/pypi.png" class=""><p>3. 上传, 一串字符滚过之后看到 <code>200</code> 就 OK 了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py upload -r pypi</span><br></pre></td></tr></table></figure><img src="/2014/06/09/how-to-register-pypi/pypi_upload.png" class="">]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;更新:&lt;br&gt;现在都用 &lt;a href=&quot;https://pypi.org/project/twine/&quot;&gt;https://pypi.org/project/twine/&lt;/a&gt; 了.&lt;/p&gt;
&lt;p&gt;距上次发布软件包过去了很久, 都忘了操作步骤了, 今天碰巧发布一个小包, </summary>
      
    
    
    
    <category term="python" scheme="http://lixxu.github.io/categories/python/"/>
    
    
    <category term="python" scheme="http://lixxu.github.io/tags/python/"/>
    
    <category term="pypi" scheme="http://lixxu.github.io/tags/pypi/"/>
    
  </entry>
  
</feed>
